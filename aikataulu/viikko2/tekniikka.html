<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Tietokantojen ja palvelimien käyttöönotto</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/bootstrap.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.treeview.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.scrollTo.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.nav.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../aikataulu/viikko1/index.html">Viikko 1</a>
<ul>
<li><a href="../../aikataulu/viikko1/aiheet/index.html">Aiheet</a>
<ul>
<li><a href="../../aikataulu/viikko1/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Harjoitustyon_seuranta.html">Harjoitustyön seuranta</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kuluttajan_tuki_Ry.html">Kuluttajan tuki Ry</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Lainahakemusten_kasittely.html">Lainahakemusten käsittely</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Painontarkkailu.html">Painontarkkailu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tyontekijanvuokraus_kotitoihin.html">Työntekijänvuokraus kotitöihin</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tyryhmtiedotus.html">Työryhmätiedotus</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko1/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../aikataulu/viikko1/tietokannat.html">Tietokannan valinta</a></li>
<li><a href="../../aikataulu/viikko1/dokumentointi.html">Dokumentaation aloittaminen</a></li>
<li><a href="../../aikataulu/viikko1/git-ohje.html">Versionhallinta</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko2/index.html">Viikko 2</a>
<ul>
<li class="selected"><a href="../../aikataulu/viikko2/tekniikka.html">Tietokantojen ja palvelimien käyttöönotto</a></li>
<li><a href="../../aikataulu/viikko2/suunnittelu.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../aikataulu/viikko2/tietokanta.html">Tietokannan suunnittelu</a></li>
<li><a href="../../aikataulu/viikko2/netbeans.html">NetBeansin käyttöönotto</a></li>
<li><a href="../../aikataulu/viikko2/html-versioiden-luonti.html">HTML-versioiden luominen</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko3/index.html">Viikko 3</a>
<ul>
<li><a href="../../aikataulu/viikko3/arkkitehtuuri.html">Arkkitehtuuriohje</a></li>
<li><a href="../../aikataulu/viikko3/java/index.html">Kirjautuminen Javalla</a>
<ul>
<li><a href="../../aikataulu/viikko3/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li><a href="../../aikataulu/viikko3/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../aikataulu/viikko3/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko3/php/index.html">Kirjautuminen PHP:llä</a>
<ul>
<li><a href="../../aikataulu/viikko3/php/rakenne.html">Mihin eri tiedostot kannattaa laittaa?</a></li>
<li><a href="../../aikataulu/viikko3/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../aikataulu/viikko3/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
</ul></li>
</ul></li>
<li><a href="../../aikataulu/viikko4/index.html">Viikko 4</a>
<ul>
<li><a href="../../aikataulu/viikko4/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../aikataulu/viikko4/ssh-tunnelit.html">SSH-tunnelointi</a></li>
<li><a href="../../aikataulu/viikko4/mallit.html">Mallit ja tietokanta</a></li>
<li><a href="../../aikataulu/viikko4/nakymat.html">Tietokohteen sivujen toteuttaminen</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko5/index.html">Viikko 5</a>
<ul>
<li><a href="../../aikataulu/viikko5/java-users.html">Java-työn vieminen users-palvelimelle</a></li>
</ul></li>
<li><a href="../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Tietokantojen ja palvelimien käyttöönotto</h1>
</header>
<!-- order: 1 -->
<script>addSectionLinks = true; </script>

<p>Ota käyttöösi users-palvelimen Java- tai PHP-tuki, sekä käyttämäsi tietokanta.</p>
<section id="ssh-yhteydet" class="level2">
<h2>SSH-yhteydet</h2>
<p>Ensiksi sinun pitää kirjautua laitoksen tietokantasovelluspalvelimelle SSH:llä. Käytä Windowsissa <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">Puttyä</a> ja muissa käyttäjärjestelmissä komentoriviä ja ssh-ohjelmaa.</p>
<p>Ssh-ohjelma toimii kirjoittamalla alla esitetyn tapainen komento komentoriville. Ohjelma kysyy cs-tunnuksesi salasanaa ja päästää sinut sisälle palvelimeen.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh</span> kayttajatunnuksesi@users.cs.helsinki.fi</code></pre>
<p>Laitoksen koneilla toimii myös lyhyempi ja kätevämpi muoto:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh</span> users</code></pre>
<section id="ssh-yhteydet-windowsilla" class="level3">
<h3>SSH-yhteydet Windowsilla</h3>
<p>Windowsin oma komentorivi on senverran kömpelö, että SSH-yhteyksiä varten on kehitetty oma komentoriviohjelmansa <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">Putty</a>. Yhteyden saa aikaan kuvan mukaisella tavalla. Luotu yhteys kannattaa tallentaa kirjoittamalla Saved sessions-tekstin alla olevaan kenttään yhteydelle nimi ja painamalla Save-nappia. Yhteys tallentuu kentän alla olevaan listaan, josta sen voi helposti avata kaksoisklikkaamalla sitä.</p>
<figure>
<img src="../../images/aikataulu/viikko2/putty-users.png" alt="users-palvelimen yhteyden luominen" /><figcaption>users-palvelimen yhteyden luominen</figcaption>
</figure>
</section>
</section>
<section id="ohjelmointikielten-ja-tietokantojen-aktivointi" class="level2">
<h2>Ohjelmointikielten ja tietokantojen aktivointi</h2>
<p>Kun olet päässyt käyttämälläsi ssh-ohjelmalla sisään aktivoi valitsemasi ohjelmointikielen ja tietokannan tuki.</p>
<section id="java-tuki" class="level3">
<h3>Java-tuki</h3>
<p>Lue sivu <a href="http://www.cs.helsinki.fi/u/laine/tikas/material/servlet_ohje.html">Servlettien käyttö Tietokantasovellusten harjoitustyössä</a> ja noudata sen ohjeita. Liitä tämän jälkeen dokumentaatiosi <a href="../../dokumentaatio-ohje.html#käynnistys--käyttöohje">Käynnistys- / käyttöohje -kappaleeseen</a> sovelluksesi nettiosoite usersilla (tai muulla palvelimella, mikäli haluat käyttää sellaista). Kappaleeseen ei tässä vaiheessa tarvitse kirjoittaa muuta sisältöä.</p>
</section>
<section id="php-tuki" class="level3">
<h3>PHP-tuki</h3>
<p>PHP sivut sijoitetaan users-koneen käyttäjän htdocs hakemistoon tai sen alihakemistoon. Hakemiston htdocs saa luotua komentoskriptillä komennolla <code>wanna-htdocs</code>.</p>
<p>PHP sivut ajetaan käyttäjän oikeuksin, eikä niille tarvita mitään erityisiä luku- tai suoritusoikeuksia. Kuitenkin, jos php-sivuilla on viittauksia kuviin tai muihin tähän hakemistoon tai sen alihakemistoihin sijoitettuihin resursseihin kuten tyylitiedostoihin tai javascript koodiin, on näille annettava laaja lukuoikeus ja hakemistoille läpikulkuoikeus. Myös staattisille tavallisille html-sivuille on annettava maailmalle lukuoikeus. Seuraava komento varmistaa riittävät oikeudet sekä koodihakemistoille, että niissä oleville tiedostoille:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">chmod</span> -R a+X <span class="ot">$HOME</span> <span class="ot">$HOME</span>/htdocs</code></pre>
<p>Mikäli sinulla on jo tiedostoja tässä hakemistossa, saat niille lukuoikeudet komennolla:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">chmod</span> -R a+r <span class="ot">$HOME</span>/htdocs/*</code></pre>
<p>Siinä vaiheessa kun sivut ovat pystyssä htdocs-kansiossa olevaan PHP-tiedostoon <code>sivu.php</code> viitataan osoitteella: <em>http://käyttäjätunnuksesi.users.cs.helsinki.fi/sivu.php</em></p>
<p>Esimerkiksi <em>http://laine.users.cs.helsinki.fi/lahja/lahjax.php</em> osoittaa php-tiedostoon <em>/home/laine/htdocs/lahja/lahjax.php</em></p>
<p>Liitä PHP-tuen pystytyksen jälkeen dokumentaatiosi <a href="../../dokumentaatio-ohje.html#käynnistys--käyttöohje">Käynnistys- / käyttöohje -kappaleeseen</a> sovelluksesi nettiosoite usersilla (tai muulla palvelimella, mikäli haluat käyttää sellaista). Kappaleeseen ei tässä vaiheessa tarvitse kirjoittaa muuta sisältöä.</p>
<section id="virheilmoitukset" class="level4">
<h4>Virheilmoitukset</h4>
<p>PHP:n virheilmoitukset kirjautuvat tiedostoon <code>/home/userlogs/käyttäjätunnuksesi.error</code>. Uusimmat virheet löytyvät tiedoston lopusta. Kätevä tapa seurata PHP:n tuottamia virheviestejä on ajaa komento:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">tail</span> -f /home/userlogs/<span class="ot">$USER</span>.error</code></pre>
<p>Komento näyttää viimeiset kymmenen virheviestiä ja jää komentoriville seuraamaan virheviestejä näyttäen aina viimeisimmät. Kommenon pystyy sulkemaan painamalla Ctrl+C:tä.</p>
<p>Virheloki saattaa ajoittain täyttyä seuraavanlaisista virheviesteistä:</p>
<pre><code>[Mon Sep 09 16:58:56 2013] [error] [client 128.214.137.101] File does not exist: /home/consuegr/htdocs/favicon.ico</code></pre>
<p>Virheistä pääsee halutessaan eroon laittamalla sovellukselleen <a href="http://fi.wikipedia.org/wiki/Favicon">favicon.ico:n</a>.</p>
</section>
</section>
<section id="postgresql" class="level3">
<h3>PostgreSQL</h3>
<p>PostgreSQL-kannan saat käyttöösi koneessa users.cs.helsinki.fi skriptillä <code>wanna-postgres</code>. Ohjelma luo käyttäjätunnuksen ja arpoo salasanan ja kannan käyttöön tarvittavat porttinumerot ja hoitaa muut ympäristöasetukset. Kun tunnus on luotu voi kantaa käsitellä käyttäen komentotulkkia <code>psql</code>. Tulkki ei kysy salasanaa, vaan siirtyy suoraan tietokantakomentoriville.</p>
<p>Testaa tulkkia luomalla kantaan muutama testitaulu. Tulkkia käyttäessä kannattaa varoa, ettei jätä lainausmerkkejä auki:</p>
<pre><code>consuegr=&gt; select * from test where t1 = &#39;asdasd;
consuegr&#39;&gt; 
consuegr&#39;&gt; quit
consuegr&#39;&gt; &#39;
consuegr-&gt; ;
 t1 
 ----
 (0 rows)</code></pre>
<p>Huomaa kuinka käyttäjänimen jälkeen tuleva merkki vaihtuu sen mukaan mitä merkkiä tietokantatulkki odottaa seuraavaksi.</p>
</section>
<section id="mysql" class="level3">
<h3>MySql</h3>
<p>MySql-kannan saat käyttöösi koneessa users.cs.helsinki.fi skriptillä <code>wanna-mysql</code>. Ohjelma kysyy sinulta uuden tietokannan pääkäyttäjän salasanaa. Pistä se johonkin ylös, sillä sitä ei tallenneta mihinkään siltä varalta että unohdat sen! Ohjelma myös käynnistää tietokannan. Voit kirjautua sen komentotulkkiin komennolla</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mysql</span> -u root -p</code></pre>
<p>Usersin MySql-tietokannat eivät ole julkisia, vaan ne ajetaan käyttäjäkohtaisina prosesseina palvelimella. Tietokannan käynnistyksestä ja sammuttamisesta huolehdit sinä. Voit manuaalisesti käynnistää ja sammuttaa tietokantaasi komennoilla <code>start-mysql</code> ja <code>stop-mysql</code>. Sammuttaminen kysyy sinulta pääkäyttäjän salasanan.</p>
<p>Tätä tietokantaa ei pysty etäkäyttämään kovin helposti palvelimen ulkopuolelta, joten sitä on parasta käyttää ainoastaan, jos saat myös lokaaliin koodausympäristöösi MySql-tietokannan asennettua tai jos käytät esimerkiksi NetBeansia siirtääksesi PHP-sovelluksesi automaattisesti Users-palvelimelle.</p>
<p>MySql:ään pätevät samat lainausmerkkejä koskevat huomiot kuin PostgreSQL:ään ylempänä.</p>
<section class="alert alert-info"><h3>
Lisätietoa
</h3>
<p>Voit testata mysql-tietokantayhteyttä seuraavanlaisella lyhyellä PHP-tiedostolla:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">&lt;?php</span>
<span class="kw">$p</span> = <span class="kw">new</span> <span class="kw">PDO</span><span class="ot">(</span><span class="st">&#39;mysql:unix_socket=/home/consuegr/mysql/socket;dbname=test&#39;</span><span class="ot">,</span><span class="st">&#39;root&#39;</span><span class="ot">,</span> <span class="st">&#39;salasana&#39;</span><span class="ot">);</span>
<span class="fu">var_dump</span><span class="ot">(</span><span class="kw">$p</span><span class="ot">);</span>
<span class="kw">?&gt;</span>
OK</code></pre>
</section>

</section>
</section>
<section id="lisäluettavaa" class="level2">
<h2>Lisäluettavaa</h2>
<ul>
<li><a href="http://users.cs.helsinki.fi/README.users.cs.helsinki.fi.txt">Users-palvelimen tiivis ohjetiedosto</a></li>
</ul>
<section class="alert alert-success small"><h3>
Seuraavaksi:
</h3>
<p>Siirry suunnittelemaan sovelluksesi <a href="suunnittelu.html">käyttöliittymää</a>,</p>
</section>




</section>
</div>
</div> 
</div> 
<footer>
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>
