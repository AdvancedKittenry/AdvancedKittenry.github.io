<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Viikko 4</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/bootstrap.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.treeview.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.scrollTo.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.nav.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../aikataulu/viikko1/index.html">Viikko 1</a>
<ul>
<li><a href="../../aikataulu/viikko1/aiheet/index.html">Aiheet</a>
<ul>
<li><a href="../../aikataulu/viikko1/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Harjoitustyon_seuranta.html">Harjoitustyön seuranta</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kuluttajan_tuki_Ry.html">Kuluttajan tuki Ry</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Lainahakemusten_kasittely.html">Lainahakemusten käsittely</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Painontarkkailu.html">Painontarkkailu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tyontekijanvuokraus_kotitoihin.html">Työntekijänvuokraus kotitöihin</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Tyryhmtiedotus.html">Työryhmätiedotus</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../aikataulu/viikko1/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko1/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../aikataulu/viikko1/tietokannat.html">Tietokannan valinta</a></li>
<li><a href="../../aikataulu/viikko1/dokumentointi.html">Dokumentaation aloittaminen</a></li>
<li><a href="../../aikataulu/viikko1/git-ohje.html">Versionhallinta</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko2/index.html">Viikko 2</a>
<ul>
<li><a href="../../aikataulu/viikko2/tekniikka.html">Tietokantojen ja palvelimien käyttöönotto</a></li>
<li><a href="../../aikataulu/viikko2/suunnittelu.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../aikataulu/viikko2/tietokanta.html">Tietokannan suunnittelu</a></li>
<li><a href="../../aikataulu/viikko2/netbeans.html">NetBeansin käyttöönotto</a></li>
<li><a href="../../aikataulu/viikko2/html-versioiden-luonti.html">HTML-versioiden luominen</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko3/index.html">Viikko 3</a>
<ul>
<li><a href="../../aikataulu/viikko3/arkkitehtuuri.html">Arkkitehtuuriohje</a></li>
<li><a href="../../aikataulu/viikko3/java/index.html">Kirjautuminen Javalla</a>
<ul>
<li><a href="../../aikataulu/viikko3/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li><a href="../../aikataulu/viikko3/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../aikataulu/viikko3/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
</ul></li>
<li><a href="../../aikataulu/viikko3/php/index.html">Kirjautuminen PHP:llä</a>
<ul>
<li><a href="../../aikataulu/viikko3/php/rakenne.html">Mihin eri tiedostot kannattaa laittaa?</a></li>
<li><a href="../../aikataulu/viikko3/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../aikataulu/viikko3/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
</ul></li>
</ul></li>
<li class="selected"><a href="../../aikataulu/viikko4/index.html">Viikko 4</a></li>
<li><a href="../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Viikko 4</h1>
</header>
<!-- order: 1 -->

<section class="alert alert-warning small"><h3>
Deadline:
</h3>
<span class="coursekeyword deadline4">pe 27.9 klo 23:00</span>
</section>

<p>Työaiheet neljännellä viikolla lyhyesti:</p>
<p><strong>Tietokannan kokeilu ja yhteydenotto</strong></p>
<ul>
<li>Varmista että aikaisemmin kirjoittamasi sql-lauseet toimivat siten tietokantataulusi ovat nyt pystyssä kannassa.</li>
<li>Tietokantayhteyden luonti.
<ul>
<li>Luominen pitää sijoittaa omaan tiedostoonsa/luokkaansa, josta muut tiedostot sitä käyttävät.</li>
<li>Javalle NetBeans-ohjeita käyttäneille hyödyllistä on myös: <a href="http://www.postgresql.org/docs/8.2/static/ssh-tunnels.html">PostgreSQL-ssh-tunnelin luonti</a>.
<ul>
<li>Windowsilla ssh-tunnelin saa aikaan Puttyllä.</li>
</ul></li>
<li>Tietokantaa kannattaa tässä vaiheessa testata jollain hyvin yksinkertaisella testikoodilla.</li>
</ul></li>
<li>Javalla tietokantayhteydet pitää vielä sulkea aineistopyynnön käsittelyn lopuksi
<ul>
<li>Tätä varten kannattaa tehdä oma metodi</li>
<li>Kutsu metodia servletistä käsin vasta sitten, kun kaikki tietokantakutsut on tehty.
<ul>
<li>Tietokantayhteyttä ei kannata avata ja sulkea monta kertaa per aineistopyyntö. Yhteyksien availu ja sulkeminen on usein varsin hidasta.</li>
</ul></li>
<li>PHP:llä asiasta ei tarvitse huolehtia, sillä kieli sulkee yhteyden automaattisesti skriptin suorituksen lopuksi.</li>
</ul></li>
</ul>
<p><strong>Tietokantaa käyttävän mallin luominen</strong></p>
<ul>
<li>Käytännössä jokaista tietokohdetta vastaa yksi malliluokka.
<ul>
<li>Puhtaille välitauluille harvemmin tarvitaan omaa luokkaansa, vaan niiden toiminnot hoidetaan tietokohteiden kautta.</li>
<li>Luokka sisältää tarvittavat metodit.</li>
<li>Käytetään sekä instanssimetodeja, että staattisia metodeja.
<ul>
<li>Instanssimetodit käsittelevät yksittäiseen taulun riviin liittyvää tietoa.</li>
<li>Staattiset metodit hakevat kannasta olioita sekä päivittävät tai poistavat kannasta useita olioita kerralla.</li>
<li>Oliolla kannattaa yleensä olla metodi, jolla se osaa syöttää itsensä kantaan (INSERT-lause).
<ul>
<li>Autogeneroituja id-numeroita (esim. PostgreSQL:n <a href="http://www.postgresql.org/docs/9.2/static/datatype-numeric.html#DATATYPE-SERIAL">SERIAL-tietotyyppi</a>) varten olemassa omat rajapintansa:
<ul>
<li>PHP:llä PDO:n <a href="http://php.net/manual/en/pdo.lastinsertid.php">lastInsertId-metodi</a>.</li>
<li>Javalle olemassa <a href="http://www.technicalkeeda.com/details/how-to-get-mysql-auto-increment-key-value-using-java-jdbc">vastaava tekniikka</a>.</li>
<li>SERIAL-tyyppiä käytettäessä INSERT-lauseeseen ei laiteta id-avaimelle lainkaan arvoa, jolloin kanta laittaa kenttään seuraavan vapaan arvon.</li>
</ul></li>
</ul></li>
<li>Päivittämiseen tarvitaan vastaavaa metodia, joka ajaa UPDATE-lauseen, samoin poistamiselle on tarpeen DELETE-lauseen ajava instanssimetodi.</li>
</ul></li>
</ul></li>
<li>Käytetyn SQL-koodin pitää olla turvallista niin, ettei se tarjoa mahdollisuuksia SQL-injektioille.
<ul>
<li>Tähän käytetään PDO:n ja javan JDBC:n prepared statements -tukia.</li>
<li>Kyselyihin upotetaan parametreja laittamalla SQL-komentojen sekaan kysymysmerkkejä, joiden sisällön voi täyttää ohjelmallisesti.
<ul>
<li><a href="../viikko1/ohjelmointikielet.html#tietokannan-käyttö">Lyhyt esimerkki PDO:n ja JDBC:n käytöstä</a></li>
</ul></li>
</ul></li>
</ul>
<p><strong>Lomakkeiden ja sivujen toteuttaminen</strong></p>
<ul>
<li>Lisäys- ja muokkauslomakkeet kannattaa toteuttaa samalla tai ainakin hyvin samanlaisella koodilla.</li>
<li>Muokkaustoiminnot kannattaa toteuttaa niin, että sivun käsittelijä ottaa muokattavan tietokohteen id:n tai muun avaimen GET-parametrina ja näyttää sen perusteella oikean kohteen.
<ul>
<li>Poisto ym. vastaavat toiminnot toimivat käytännössä samoin. Usein niiden aktivointii kannattaa tosin käyttää lomakkeisiin upotettuja nappeja ja POST-metodia.</li>
</ul></li>
<li>Muokkauslomake koodataan näyttämään GET-parametrin määrittämän olion tiedot valmiina kentissä.
<ul>
<li>Olio haetaan mallilta sopivalla metodilla.</li>
<li>Malli ei koskaan käsittele GET- tai POST-parametreja suoraan vaan ne käsittelijä välittää ne mallin metodeille.</li>
</ul></li>
<li>Lomakkeen käsittelijä ohjaa takaisin lomakesivulle, mikäli lomake on virheellisesti täytetty.
<ul>
<li>Lomakesivulla tällöin näkyvissä ne tiedot, jotka käyttäjä siihen syötti.
<ul>
<li>Tiedot voidaan näyttää antamalla lomakkeelle näytettäväksi malliluokan olio, johon on asetettu käyttäjän syöttämät lomaketiedot.</li>
</ul></li>
<li>Väärin syötetyt tiedot eritellään vielä virheilmoituksin. Mieluiten kaikki kerrallaan.</li>
</ul></li>
<li>Sekä lomakkeita, että sivunäkymiä näytettäessä kannattaa varmistaa, etteivät käyttäjän syöttämät HTML-koodinpätkät, lainausmerkit yms. sotke sivujen rakennetta.
<ul>
<li>PHP:ssä <a href="http://www.php.net/manual/en/function.htmlspecialchars.php">htmlspecialchars-funktio</a> auttaa: <code>&lt;?php echo htmlspecialchars($muuttuja); ?&gt;</code></li>
<li>Javassa voi käyttää <a href="http://docs.oracle.com/javaee/5/jstl/1.1/docs/tlddocs/">out-tägiä</a>: <code>&lt;c:out value=&quot;${muuttuja}&quot;/&gt;</code></li>
</ul></li>
</ul>
<section id="nelosviikon-deadline" class="level2">
<h2>Nelosviikon deadline</h2>
<p>Palautuspäivämäärään mennessä työn on täytettävä seuraavat vaatimukset:</p>
<ul>
<li>Tietokantayhteys toimii, ja sen luonti on sijoitettu omaan metodiinsa/funktioonsa.</li>
<li>Luotu ainakin yksi malliluokka, joka:
<ol type="1">
<li>Sisältää staattisia metodeja, jotka hakevat kannasta eri kriteerein rivejä olioiksi. (Esim. kissalistan hakutoiminto, yksittäisen kissan hakeminen id-numerolla yms.)</li>
<li>Sisältää metodin, joka lisää olion kantaan (INSERT-lause).</li>
<li>Sisältää metodin, joka päivittää olion tiedot kantaan (UPDATE-lause).</li>
<li>Sisältää metodin joka poistaa olion kannasta, voidaan toteuttaa myös staattinen metodi, joka poistaa hakuehdolla rivejä taulusta.</li>
</ol></li>
<li>Käytetty SQL-koodi on turvallinen, eikä tarjoa mahdollisuuksia SQL-injektioille.</li>
<li>Luotu sivut, jossa edellä mainittuja malliluokan toimintoja käytetään hyväksi. Käytettävyyden pitää olla kohdallaan:
<ul>
<li>Sivuilla selkeät virheilmoitukset kaikista virhetilanteista ja lomakkeiden syöttövirheistä.</li>
<li>Lomakkeen käsittelijä ohjaa takaisin lomakesivulle, mikäli lomake on virheellisesti täytetty.
<ul>
<li>Lomakesivulla tällöin näkyvissä ne tiedot, jotka käyttäjä siihen syötti.</li>
<li>Väärin syötetyt tiedot kerrotaan virheilmoituksin.</li>
</ul></li>
<li>Tiedot näkyvät sivuilla oikein myös silloin kun käyttäjä on syöttänyt niiden sekaan HTML:ää, lainausmerkkejä yms.</li>
</ul></li>
</ul>
</section>
</div>
</div> 
</div> 
<footer>
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>
