<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Istunnot ja kirjautumisen tallentaminen</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../../css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script src="../../../javascript/bootstrap.js"></script>
  <script src="../../../javascript/jquery.treeview.js"></script>
  <script src="../../../javascript/jquery.scrollTo.js"></script>
  <script src="../../../javascript/jquery.nav.js"></script>
  <script src="../../../javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../../aikataulu/viikko1/index.html">Viikko 1</a>
<ul>
<li><a href="../../../aikataulu/viikko1/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../../aikataulu/viikko1/tietokannat.html">Tietokannan valinta</a></li>
<li><a href="../../../aikataulu/viikko1/tekniikka.html">Koodausympäristön pystytys</a></li>
<li><a href="../../../aikataulu/viikko1/dokumentointi.html">Dokumentaation aloittaminen</a></li>
<li><a href="../../../aikataulu/viikko1/git-ohje.html">Versionhallinta</a></li>
</ul></li>
<li><a href="../../../aikataulu/viikko2/index.html">Viikko 2</a>
<ul>
<li><a href="../../../aikataulu/viikko2/suunnittelu.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../../aikataulu/viikko2/tietokanta.html">Tietokannan suunnittelu</a></li>
</ul></li>
<li><a href="../../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../../ohjeistus/index.html">Ohjeistus</a>
<ul>
<li><a href="../../../ohjeistus/html-opas.html">HTML-opas</a></li>
<li><a href="../../../ohjeistus/netbeans/index.html">NetBeansin käyttöönotto</a>
<ul>
<li><a href="../../../ohjeistus/netbeans/java.html">NetBeansin käyttö Javan kanssa</a></li>
<li><a href="../../../ohjeistus/netbeans/php.html">NetBeansin käyttö PHP:n kanssa</a></li>
<li><a href="../../../ohjeistus/netbeans/keyring-reset.html">Unlock your keyring? - Avainnippujen nollaus</a></li>
</ul></li>
<li><a href="../../../ohjeistus/tietokantaohjelmointi/index.html">Tietokantaohjelmointi</a>
<ul>
<li><a href="../../../ohjeistus/tietokantaohjelmointi/kannan-alustus.html">Tietokantataulujen pystyttäminen</a></li>
<li><a href="../../../ohjeistus/tietokantaohjelmointi/testisovellus.html">ConnectionTest-testisovellus</a></li>
<li><a href="../../../ohjeistus/tietokantaohjelmointi/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../../ohjeistus/tietokantaohjelmointi/listaustesti.html">Ensimmäinen tietokantalistaus</a></li>
</ul></li>
<li><a href="../../../ohjeistus/users/index.html">Users-palvelin ja töiden pystyttäminen</a>
<ul>
<li><a href="../../../ohjeistus/users/kayttoonotto/index.html">Palvelujen käynnistäminen ja käyttöönotto</a>
<ul>
<li><a href="../../../ohjeistus/users/kayttoonotto/java.html">Java ja Tomcatin käyttöönotto</a></li>
<li><a href="../../../ohjeistus/users/kayttoonotto/mysql.html">MySql-tietokannan käyttöönotto</a></li>
<li><a href="../../../ohjeistus/users/kayttoonotto/php.html">PHP-tuen käyttöönotto</a></li>
<li><a href="../../../ohjeistus/users/kayttoonotto/postgresql.html">PostgreSQL-tietokannan käyttöönotto</a></li>
</ul></li>
<li><a href="../../../ohjeistus/users/postgres-ssh-tunneli.html">PostgreSql-kannan etäkäyttö</a></li>
<li><a href="../../../ohjeistus/users/java-war-paketit.html">Kotikoneella tehdyn Java-työn julkaisu</a></li>
<li><a href="../../../ohjeistus/users/nautilus-ssh.html">Tiedostojen etämuokkaus Linuxilla</a></li>
</ul></li>
</ul></li>
<li><a href="../../../aiheet/index.html">Työaiheet</a>
<ul>
<li><a href="../../../aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../../aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../../aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../../aiheet/Harjoitustyon_seuranta.html">Harjoitustyön seuranta</a></li>
<li><a href="../../../aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../../aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../../aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../../aiheet/Kuluttajan_tuki_Ry.html">Kuluttajan tuki Ry</a></li>
<li><a href="../../../aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../../aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../../aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../../aiheet/Lainahakemusten_kasittely.html">Lainahakemusten käsittely</a></li>
<li><a href="../../../aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../../aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../../aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../../aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../../aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../../aiheet/Painontarkkailu.html">Painontarkkailu</a></li>
<li><a href="../../../aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../../aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../../aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../../aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../../aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../../aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../../aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../../aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../../aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../../aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../../aiheet/Tyontekijanvuokraus_kotitoihin.html">Työntekijänvuokraus kotitöihin</a></li>
<li><a href="../../../aiheet/Tyryhmtiedotus.html">Työryhmätiedotus</a></li>
<li><a href="../../../aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../../aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../../aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../../aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../../aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../../mvc-opas.html">MVC-arkkitehtuuriopas</a></li>
<li><a href="../../../sivukartta.html">Sivukartta</a></li>
<li><a href="../../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Istunnot ja kirjautumisen tallentaminen</h1>
</header>
<!-- order: 3 -->

<p>Edellä toteutetussa kirjautumisessa on se huono puoli, ettei se tallennu mihinkään, sillä <a href="../../../web-sovelluksista.html#tilatiedon-hallinta-ja-samanaikaiset-aineistopyynn%C3%B6t">HTTP-protokolla on tilaton</a>, eikä aineistopyyntöjen välillä talleteta informaatiota.</p>
<p>Apuun ongelmaan tulee Javan istuntotuki. Istunnot ovat ikäänkuin pieniä, käyttäjä- ja selainkohtaisia tietokantoja, joihin voi tallettaa olioita siten, että ne säilyvät sivulataukselta toiselle.</p>
<p>Kirjautumisen tapauksessa haluamme tallentaa tiedon siitä kuka on kirjautunut sisään. Tieto tallennetaan istuntoon siinä vaiheessa, kun käyttäjä kirjautuu sisään ja sitä käytetään aina kun halutaan tarkastella onko käyttäjä kirjautunut sivulle.</p>
<p>Javassa istunto alustetaan käyttämällä HttpServletRequest-olion <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html#getSession(boolean)">getSession-metodia</a>. Metodi palauttaa käyttäjän istunnon tai mikäli sellaista ei vielä ole olemassa, luo sen. Istunto-olioon voi tämän jälkeen tallentaa tietoa ja tarkastella siellä olevia tietoja.</p>
<pre class="sourceCode java"><code class="sourceCode java">HttpSession session = request.<span class="fu">getSession</span>();
session.<span class="fu">setAttribute</span>(<span class="st">&quot;kirjautunut&quot;</span>, <span class="kw">new</span> <span class="fu">Kayttaja</span>(<span class="st">&quot;Kalle&quot;</span>));

<span class="co">// Ohessa kätevä tapa välittää virheviestejä silloin kun käytetään HTTP-redirectiä */</span>
String lomakekasittelijanVirheviesti = (String)session.<span class="fu">getAttribute</span>(<span class="st">&quot;virheViesti&quot;</span>);
session.<span class="fu">removeAttribute</span>(<span class="st">&quot;virheViesti&quot;</span>);</code></pre>
<p>Käytä istunto-oliota kirjautumisservletissäsi siten, että talletat jokaisen onnistuneen kirjautumisen yhteydessä kirjautuneen käyttäjän tiedot istuntoon.</p>
<section id="kirjautumisen-tarkistaminen" class="level2">
<h2>Kirjautumisen tarkistaminen</h2>
<p>Lisää yleiskäyttöiseen servlet-yläluokkaasi metodi, joka palauttaa arvon <code>true</code>, mikäli käyttäjä on kirjautunut ja istunnossa on tallennettuna käyttäjän kirjautumistiedot. Metodi voi halutessasi myös ohjata käyttäjän kirjautumissivulle mikäli näin ei ole. Näin kirjautumista vaativat sivut voivat kätevästi tarkistaa onko käyttäjä oikeasti kirjautunut.</p>
<p>Jos sovelluksessasi on monia erilaisia käyttöoikeustasoja tms., voit tehdä vastaavan metodin myös käyttöoikeuden tarkistamiseen.</p>
<p>Käytä tekemääsi metodia estääksesi käyttäjää pääsemästä kirjautumista vaativille sivuille ilman kirjautumista.</p>
</section>
<section id="uloskirjautuminen" class="level2">
<h2>Uloskirjautuminen</h2>
<p>Kun olet lisännyt kirjautumistarkistuksen kaikille sivuille jotka sitä vaativat, uloskirjautumisen toteuttamiseksi riittää poistaa istuntoon tallennetut tiedot kirjautumisesta. Tämän jälkeen käyttäjä ei enää pääse sivuille sisään.</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="co">//Kirjaudutaan ulos</span>
session.<span class="fu">removeAttribute</span>(<span class="st">&quot;kirjautunutKayttaja&quot;</span>);</code></pre>
<section class="alert alert-info small"><h3>
Valmista!
</h3>

<p>Kun olet toteuttanut kaikki näissä ohjeissa mainitut asiat, olet saanut valmiiksi viikon 3 palautuksen. Varmista vielä, että kaikki tiedostot löytyvät repositoriostasi.</p>
</section>




</section>
</div>
</div> 
</div> 
<footer>
  <a href="../../../sivukartta.html">Sivukartta</a> - 
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>
