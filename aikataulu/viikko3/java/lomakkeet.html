<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Lomakkeiden käyttö ja vastaanottaminen</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../../css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/bootstrap.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.treeview.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.scrollTo.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/jquery.nav.js"></script>
  <script src="http://advancedkittenry.github.io/javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../../aikataulu/viikko1/index.html">Viikko 1</a>
<ul>
<li><a href="../../../aikataulu/viikko1/aiheet/index.html">Aiheet</a>
<ul>
<li><a href="../../../aikataulu/viikko1/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Harjoitustyon_seuranta.html">Harjoitustyön seuranta</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Kuluttajan_tuki_Ry.html">Kuluttajan tuki Ry</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Lainahakemusten_kasittely.html">Lainahakemusten käsittely</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Painontarkkailu.html">Painontarkkailu</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Tyontekijanvuokraus_kotitoihin.html">Työntekijänvuokraus kotitöihin</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Tyryhmtiedotus.html">Työryhmätiedotus</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../../aikataulu/viikko1/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../../aikataulu/viikko1/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../../aikataulu/viikko1/tietokannat.html">Tietokannan valinta</a></li>
<li><a href="../../../aikataulu/viikko1/dokumentointi.html">Dokumentaation aloittaminen</a></li>
<li><a href="../../../aikataulu/viikko1/git-ohje.html">Versionhallinta</a></li>
</ul></li>
<li><a href="../../../aikataulu/viikko2/index.html">Viikko 2</a>
<ul>
<li><a href="../../../aikataulu/viikko2/tekniikka.html">Tietokantojen ja palvelimien käyttöönotto</a></li>
<li><a href="../../../aikataulu/viikko2/suunnittelu.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../../aikataulu/viikko2/tietokanta.html">Tietokannan suunnittelu</a></li>
<li><a href="../../../aikataulu/viikko2/netbeans.html">NetBeansin käyttöönotto</a></li>
<li><a href="../../../aikataulu/viikko2/html-versioiden-luonti.html">HTML-versioiden luominen</a></li>
</ul></li>
<li><a href="../../../aikataulu/viikko3/index.html">Viikko 3</a>
<ul>
<li><a href="../../../aikataulu/viikko3/arkkitehtuuri.html">Arkkitehtuuriohje</a></li>
<li><a href="../../../aikataulu/viikko3/java/index.html">Kirjautuminen Javalla</a>
<ul>
<li><a href="../../../aikataulu/viikko3/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li class="selected"><a href="../../../aikataulu/viikko3/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../../aikataulu/viikko3/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
</ul></li>
<li><a href="../../../aikataulu/viikko3/php/index.html">Kirjautuminen PHP:llä</a>
<ul>
<li><a href="../../../aikataulu/viikko3/php/rakenne.html">Mihin eri tiedostot kannattaa laittaa?</a></li>
<li><a href="../../../aikataulu/viikko3/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../../aikataulu/viikko3/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
</ul></li>
</ul></li>
<li><a href="../../../aikataulu/viikko4/index.html">Viikko 4</a></li>
<li><a href="../../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Lomakkeiden käyttö ja vastaanottaminen</h1>
</header>
<!-- order: 2 -->

<p>Seuraavaksi tee servletti, joka näyttää html-demoon tekemäsi kirjautumislomakkeen JSP-tekniikalla. Voit laittaa servlettisi esim. osoitteeseen <code>/kirjautuminen</code> tai <code>/login</code>.</p>
<p>Laitetaan seuraavaksi tämä servlet-luokka ottamaan kirjautuminen myös vastaan.</p>
<section id="lomakkeiden-vastaanottaminen" class="level2">
<h2>Lomakkeiden vastaanottaminen</h2>
<p>Oletetaan, että kirjautumissivulla on suurinpiirtein allaolevan tapainen lomake.</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;form</span><span class="ot"> action=</span><span class="st">&quot;login&quot;</span><span class="ot"> method=</span><span class="st">&quot;POST&quot;</span><span class="kw">&gt;</span>
Käyttäjänimi: <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> name=</span><span class="st">&quot;username&quot;</span> <span class="kw">/&gt;</span>
Salasana: <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;password&quot;</span><span class="ot"> name=</span><span class="st">&quot;password&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span>Kirjaudu<span class="kw">&lt;/button&gt;</span>
<span class="kw">&lt;/form&gt;</span></code></pre>
<p>HTML-kertauksena: <code>form</code>-elementin <code>action</code>-attribuutti määrittää mihin osoitteeseen lomakkeen tiedot lähetetään, <code>method</code> sensijaan kertoo lähetetäänkö tiedot GET- vai POST-parametreina. Jokaisen <code>input</code>-elementin sisältö lähetetään parametrina, joka tunnistetaan <code>name</code>-attribuutissa annetulla nimellä.</p>
<p>Lähetetyn lomakkeen parametreja voidaan käsitellä hakemalla ne HttpServletRequest-olion <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletRequest.html#getParameter(java.lang.String)">getParameter-metodilla</a>.</p>
<p>Hyvin yksinkertainen kirjautuminen voitaisiin sitä käyttäen toteuttaa suurinpiirtein seuraavasti:</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">processRequest</span>(HttpServletRequest request, HttpServletResponse response) {
  
  String salasana = request.<span class="fu">getParameter</span>(<span class="st">&quot;password&quot;</span>);
  String kayttaja = request.<span class="fu">getParameter</span>(<span class="st">&quot;username&quot;</span>);
  
  <span class="co">/* Tarkistetaan mallilta onko parametrina saatu oikeat tunnukset */</span>
  <span class="kw">if</span> (Kissalista.<span class="fu">Mallit</span>.<span class="fu">Kayttaja</span>.<span class="fu">getKayttaja</span>(kayttaja, salasana) != <span class="kw">null</span>) {
    <span class="co">/* Jos tunnus on oikea, ohjataan käyttäjä HTTP-ohjauksella kissalistaan. */</span>
    response.<span class="fu">sendRedirect</span>(<span class="st">&quot;kissalista&quot;</span>);
  } <span class="kw">else</span> {
    <span class="co">/* Väärän tunnuksen syöttänyt saa eteensä lomakkeen ja virheen.</span>
<span class="co">     * Tässä käytetään omalta yläluokalta perittyjä yleiskäyttöisiä metodeja.</span>
<span class="co">     */</span>
    <span class="fu">asetaVirhe</span>(<span class="st">&quot;Kirjautuminen ei onnistunut. Käyttäjää ei löytynyt&quot;</span>, request);
    <span class="fu">naytaJSP</span>(<span class="st">&quot;login.jsp&quot;</span>, request, response);
  }
}</code></pre>
<p>Koodissa kannattaa huomata kutsu <code>response.sendRedirect(&quot;kissalista&quot;);</code>. <code>HttpServletResponse</code>-olion <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletResponse.html#sendRedirect(java.lang.String)">sendRedirect-metodi</a> lähettää käyttäjän selaimen parametrina annettuun osoitteesen. Tämä on kätevä tapa ohjata käyttäjä jonkin toisen servletin luo. Voit halutessasi tehdä siitäkin metodin aiemmin tekemääsi servlet-yläluokkaan.</p>
<p>Toteuta ylläolevan kaltainen tarkastus omaan kirjautumisservlettiisi. Voit tehdä tarkistuksen joko niin, että se toimii samassa servletissä tai tehdä kirjautumislomakkeen vastaanottolle oman servletin. Tee myös aiemmin tekemääsi käyttäjää mallintavaan luokkaan metodi käyttäjän hakemiseen käyttäjätunnuksella ja salasanalla. Käytä tätä metodia kirjautumisen toteuttamiseen.</p>
<p>Itse metodin ei vielä tässä vaiheessa tarvitse olla allaolevaa logiikkaa monimutkaisempi:</p>
<p><strong>Ote tiedostosta Kayttajat.java:</strong></p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> Kayttaja <span class="fu">getKayttaja</span>(String kayttaja, String salasana) {
  String oikeaSalasana = <span class="st">&quot;kala&quot;</span>;
  String oikeaKayttaja = <span class="st">&quot;admin&quot;</span>;

  <span class="kw">if</span> (oikeaKayttaja.<span class="fu">equals</span>(kayttaja) &amp;&amp; oikeaSalasana.<span class="fu">equals</span>(salasana)) {
    <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Kayttaja</span>();
  }

  <span class="kw">return</span> <span class="kw">null</span>;
}</code></pre>
<p>Varmista, että kirjautumislomake näyttää käyttäjälle järkevän virheviestin mikäli kirjautuminen ei onnistu.</p>
<section class="alert alert-success small"><h3>
Seuraavaksi:
</h3>

<p>Seuraavaksi käytämme istuntoja <a href="istunnot.html">kirjautumisen tallentamiseen sivulatausten välillä</a>.</p>
</section>




</section>
</div>
</div> 
</div> 
<footer>
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>
