<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Näkymien tekeminen ja JSP</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../css/base.css">
  <link rel="icon" href="../../images/kissa.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="../../javascript/jquery.min.js"></script>
  <script src="../../javascript/bootstrap.js"></script>
  <script src="../../javascript/jquery.treeview.js"></script>
  <script src="../../javascript/jquery.scrollTo.js"></script>
  <script src="../../javascript/jquery.nav.js"></script>
  <script src="../../javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/index.html">Viikottaiset palautukset</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/esittelysivu.html">Työn esittelysivu</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko1.html">Viikko 1</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko2.html">Viikko 2</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko3.html">Viikko 3</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko4.html">Viikko 4</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko5.html">Viikko 5</a></li>
</ul></li>
<li><a href="../../aikataulu/koodikatselmointi.html">Koodikatselmointi</a></li>
<li><a href="../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/index.html">Työn suunnittelu ja työympäristön pystytys</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/index.html">Työaiheet</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Henkilogalleria.html">Henkilögalleria</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Keskustelufoorumi.html">Keskustelufoorumi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Pokemon-kanta.html">Pokémon-tietokanta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/tietokannan-valinta.html">Tietokannan valinta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/git.html">Versionhallinnan käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/alkudokumentointi.html">Perusasioiden dokumentointi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/index.html">Users-palvelin ja töiden pystyttäminen</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/java.html">Java ja Tomcatin käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/php.html">PHP-tuen käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/mysql.html">MySql-tietokannan käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/postgresql.html">PostgreSQL-tietokannan käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/postgres-ssh-tunneli.html">PostgreSql-kannan etäkäyttö</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/index.html">NetBeansin käyttöönotto</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/java.html">NetBeansin käyttö Javan kanssa</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/php.html">NetBeansin käyttö PHP:n kanssa</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/keyring-reset.html">Unlock your keyring? - Avainnippujen nollaus</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/etamuokkaus.html">Tiedostojen etämuokkaus Linuxilla</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/kayttoliittyma.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/kayttoliittyman_toteutus.html">Käyttöliittymädemon toteuttaminen</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/tietokanta.html">Tietokannan suunnittelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/tietokanta-dokumentointi.html">Tietokannan dokumentointi</a></li>
</ul></li>
<li><a href="../../koodaaminen/index.html">Ohjelmointiohjeistus</a>
<ul>
<li><a href="../../koodaaminen/kannan-alustus.html">Tietokantataulujen pystyttäminen</a></li>
<li><a href="../../koodaaminen/testisovellus.html">ConnectionTest-testisovellus</a></li>
<li><a href="../../koodaaminen/git-ja-salasanat.html">Git-repositoriot ja salasanat</a></li>
<li><a href="../../koodaaminen/arkkitehtuuri/index.html">Arkkitehtuuri ja MVC</a>
<ul>
<li><a href="../../koodaaminen/arkkitehtuuri/nyrkkisaannot.html">MVC-mallin nyrkisääntöjä</a></li>
</ul></li>
<li><a href="../../koodaaminen/java/index.html">Java-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/java/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/java/listaustesti.html">Listaustesti</a></li>
<li><a href="../../koodaaminen/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li class="selected"><a href="../../koodaaminen/java/nakymat.html">Näkymien tekeminen ja JSP</a></li>
<li><a href="../../koodaaminen/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/java/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/java/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../../koodaaminen/java/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../../koodaaminen/java/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../../koodaaminen/java/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
<li><a href="../../koodaaminen/java/java-war-paketit.html">Kotikoneella tehdyn Java-työn julkaisu</a></li>
<li><a href="../../koodaaminen/java/tomcatin-korjaaminen.html">Tomcatin ongelmien ratkominen</a></li>
</ul></li>
<li><a href="../../koodaaminen/php/index.html">PHP-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/php/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/php/listaustesti.html">Listaustesti</a></li>
<li><a href="../../koodaaminen/php/rakenne.html">Sovelluksen rakenne ja kontrollerit</a></li>
<li><a href="../../koodaaminen/php/nakymat.html">Näkymien tekeminen</a></li>
<li><a href="../../koodaaminen/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/php/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/php/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../../koodaaminen/php/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../../koodaaminen/php/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../../koodaaminen/php/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
<li><a href="../../koodaaminen/php/syntaksiopas.html">Lyhyt PHP-opas Java-koodarille</a></li>
<li><a href="../../koodaaminen/php/php-virheet.html">PHP:n virheilmoitusten katselu</a></li>
</ul></li>
</ul></li>
<li><a href="../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../sivukartta.html">Sivukartta</a></li>
<li><a href="../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Näkymien tekeminen ja JSP</h1>
</header>
<!-- order: 4 -->
<script>addSectionLinks = true; </script>
<!-- tags: viikko3-java -->

<section class="alert alert-info"><h3>
Tiivistelmä:
</h3>

<ul>
<li>Laita servlettisi käyttämään HTML:n tulostukseen JSP-tiedostoa.</li>
<li>Tee JSP-tägitiedosto, ja laita JSP-sivusi HTML-runko siihen. Ota tägitiedostosi käyttöön servlettisi JSP-tiedosssa.</li>
<li>Tee sovelluksesi servleteille yläluokka, johon voi sijoittaa yleiskäyttöisiä toimintoja.</li>
</ul>
</section>

<p>Javassa näkyminä käytetään JSP-päätteisiä tiedostoja, jotka koostuvat pääasiassa HTML-koodista, jonka seassa on nettijavaa varten toteutetulla <a href="http://docs.oracle.com/javaee/5/tutorial/doc/bnahq.html">Unified Expression Language -kielellä</a> koodattuja käskyjä.</p>
<p>Yksinkertaisimmillaan JSP-tiedostona tehty näkymä näyttää tältä:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;%@page<span class="ot"> contentType</span>=<span class="st">&quot;text/html&quot;</span><span class="ot"> pageEncoding</span>=<span class="st">&quot;UTF-8&quot;</span><span class="ot"> trimDirectiveWhitespaces</span>=<span class="st">&quot;true&quot;</span><span class="ot"> </span>%&gt;
&lt;<span class="ot">!DOCTYPE html</span>&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta<span class="ot"> http-equiv</span>=<span class="dt">&quot;Content-Type&quot;</span><span class="ot"> content</span>=<span class="dt">&quot;text/html; charset=UTF-8&quot;</span>&gt;
    &lt;title&gt;JSP Page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<section id="jsp-tiedoston-käyttäminen-servlet-luokassa" class="level2">
<h2>JSP-tiedoston käyttäminen servlet-luokassa</h2>
<p>JSP-tiedoston näyttäminen tapahtuu aina servlet-luokan koodista käsin käyttämällä <code>RequestDispatcher</code>-tyyppisen olion <code>forward</code>-metodia, jolle annetaan parametrina HttpServletRequest ja HttpServletResponse-oliot. RequestDispatcher-olion saa HttpServletRequest-oliolta antamalla sille sivun, jolle pyyntö ohjataan.</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">processRequest</span>(HttpServletRequest request, HttpServletResponse response) {
  response.<span class="fu">setContentType</span>(<span class="st">&quot;text/html;charset=UTF-8&quot;</span>);
  
  <span class="co">/* Luodaan RequestDispatcher-olio, joka osaa näyttää lista.jsp:n */</span>
  RequestDispatcher dispatcher = request.<span class="fu">getRequestDispatcher</span>(<span class="st">&quot;lista.jsp&quot;</span>);
  <span class="co">/* Pyydetään dispatcher-oliota näyttämään JSP-sivunsa */</span>
  dispatcher.<span class="fu">forward</span>(request, response);
}</code></pre>
<p>Nyt mikäli ylläoleva servletti on <code>web.xml</code>-tiedostossa määritelty näkymään osoitteessa <code>/lista</code> niin näkyy tässä osoitteessa käytännössä sama sivu kuin osoitteessa <code>/lista.jsp</code>.</p>
<p>Nämä kaksi osoitetta ovat kuitenkin täysin eri asia. Ero näkyy etenkin siinä vaiheessa, kun JSP-sivulla näytetään servletissä määriteltyjä muuttujia tai esimerkiksi kun sivut haluaa näyttää vain kirjautuneille käyttäjille. Näitä pelkkä JSP-sivu ei osaa tehdä. Käyttäjä kannattaa ohjata aina servletin takana oleville sivuille.</p>
<section id="ota-käyttöön-oma-jsp-näkymä" class="level3">
<h3>Ota käyttöön oma JSP-näkymä</h3>
<p>Luo tässä vaiheessa projektisi luokille oma paketti. Esim. kissalistan paketti voisi olla <code>Kissalista</code>. Tee pakettiisi alipaketit servlettejä ja malleja varten. Esimerkiksi <code>Kissalista.Servlets</code> ja <code>Kissalista.Models</code>.</p>
<p>Luo sitten itsellesi JSP-tiedosto ja servlet-luokka ja laita servletin pyynnön käsittelymetodiin RequestDispatcher-oliota käyttävää koodia, joka ohjaa luomaasi JSP-tiedostoon ja kutsuu metodia forward.</p>
<p>Viimeistään tässä vaiheessa joutunet lisäämään muutaman importin servlettiisi. Näissä esimerkeissä niitä ei tulla erikseen luettelemaan, mutta esim. NetBeans osaa lisätä ne varsin kätevästi tiedoston alkuun, kunhan klikkailee sen antamia virhepalluroita.</p>
</section>
</section>
<section id="muuttujien-käyttö" class="level2">
<h2>Muuttujien käyttö</h2>
<p>JSP-koodiin on mahdollista sijoittaa servletiltä saatuja muuttujia ja mm. ehtolausekkeita. esimerkiksi virheviestin näyttämisen voi toteuttaa seuraavasti:</p>
<p>Asetetaan <code>processRequest</code>-metodissa aineistopyyntöä mallintavalle <code>HttpServletRequest</code>-oliolle <em>attribuutti</em>, joka sisältää viestin.</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">processRequest</span>(HttpServletRequest request, HttpServletResponse response) {
  response.<span class="fu">setContentType</span>(<span class="st">&quot;text/html;charset=UTF-8&quot;</span>);
  
  <span class="co">/* Asetetaan virheviesti */</span>
  request.<span class="fu">setAttribute</span>(<span class="st">&quot;virheViesti&quot;</span>, <span class="st">&quot;Sinulla ei ole ainuttakaan kissaa!&quot;</span>);  

  <span class="co">/* Näytetään JSP-sivu sivux.jsp */</span>
  RequestDispatcher dispatcher = request.<span class="fu">getRequestDispatcher</span>(<span class="st">&quot;sivux.jsp&quot;</span>);
  dispatcher.<span class="fu">forward</span>(request, response);
}</code></pre>
<p>JSP-sivulla on mahdollista näyttää pyyntöön asetettuja attribuutteja suoraan syntaksilla <code>${attribuutin_nimi}</code>:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;div<span class="ot"> class</span>=<span class="dt">&quot;alert alert-danger&quot;</span>&gt;Virhe! ${virheViesti}&lt;/div&gt;</code></pre>
<section class="alert alert-warning"><h3>
Huomaa!
</h3>
<p>Huomaa, että JSP-sivussa käytetyt attribuutit ovat täysin erillisiä servletin sisältämistä muuttujista ja niiden nimistä. Yhteys näiden kahden välille muodostuu ainoastaan <code>setAttribute</code>-metodin kutsujen myötä. Selkeyden vuoksi on kuitenkin hyvä idea nimetä sekä normaalit Java-muuttujat että JSP-sivun käyttämät attribuutit samaan tapaan.</p>
</section>
</section>
<section id="if-ehtolauseet" class="level2">
<h2>If-ehtolauseet</h2>
<p>Myös erilaisia koodirakenteita kuten ehtolausekkeita voi käyttää ottamalla käyttöön <em>JSTL-tägikirjaston</em> laittamalla tiedoston alkuun taglib-referenssin:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;%@ taglib<span class="ot"> prefix</span>=<span class="st">&quot;c&quot;</span><span class="ot"> uri</span>=<span class="st">&quot;http://java.sun.com/jsp/jstl/core&quot;</span><span class="ot"> </span>%&gt;</code></pre>
<p>Saatat joutua lisäämään projektiisi JSTL-kirjaston, että viite toimisi. Tämä tapahtuu NetBeansissä avaamalla valikosta projektin ominaisuusikkuna kohdasta <code>File-&gt;Project Properties</code>. Paina <em>Libraries</em>-kategoriassa nappia <em>Add Library</em> ja lisää listasta projektiin kirjasto nimeltä <code>JSTL 1.1</code>.</p>
<figure>
<img src="../../images/koodaaminen/java/jstl.png" alt="JSTL 1.1 -kirjaston lisääminen projektiin" /><figcaption>JSTL 1.1 -kirjaston lisääminen projektiin</figcaption>
</figure>
<p>Tämän jälkeen voimme näyttää virheviestin ehtolausekkeen avulla:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp"><span class="kw">&lt;c:if</span><span class="ot"> test</span>=<span class="dt">&quot;</span>${virheViesti != <span class="kw">null</span>}<span class="dt">&quot;</span><span class="kw">&gt;</span>
  &lt;div<span class="ot"> class</span>=<span class="dt">&quot;alert alert-danger&quot;</span>&gt;Virhe! ${virheViesti}&lt;/div&gt;
<span class="kw">&lt;/c:if&gt;</span></code></pre>
<p>Yllä oleva koodi näyttää virheviestin ja siihen liittyvän div-elementin vain jos attribuutti <code>virheViesti</code> on asetettu.</p>
</section>
<section id="template" class="level2">
<h2>Tag-pohjatiedoston käyttö</h2>
<p>Käytännössä suurin osa ohjelmaasi tulevista sivuista tulee sisältämään samanlaisen HTML-rungon, johon sisältyvät sivunavigaatio sekä head-tägin sisältämät otsakkeet ja tyylitiedostolinkit.</p>
<p>Tämän rungon koodia ei turhaan kannata toistaa, vaan se kannattaa sijoittaa omaan uudelleenkäytettävään tiedostoonsa. Javalla tälläiset uudelleenkäytettävät HTML-pätkät kannattaa toteuttaa erityisinä JSP-tägitiedostoina.</p>
<p>Tagitiedoston sisälle voi laittaa mitä tahansa HTML-koodia aivan kuten JSP-tiedostoonkin. Tärkein kohta koodissa on kuitenkin käsky <code>&lt;jsp:doBody/&gt;</code>, jolla voi upottaa tägiin jotain tägin käyttäjän määrittelemää sisältöä.</p>
<p>Myös omia tägispesifisiä muuttujia voi määritellä. Rivi <code>&lt;%@attribute name=&quot;pageTitle&quot;%&gt;</code> määrittelee muuttujan pageTitle, jota voi käyttää normaaliin tapaan tagin koodissa kirjoittamalla <code>${pageTitle}</code>.</p>
<p>Muuttujan sisällön määrittää tägin käyttäjä. Alla olevassa esimerkissä tiedostossa <code>web/WEB-INF/tags/pohja.tag</code> määritellylle tägille annetaan muuttuja <code>pageTitle</code> ja sisältönä yksi h1-elementti.</p>
<p><strong>helloworld.jsp</strong></p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;%@page<span class="ot"> contentType</span>=<span class="st">&quot;text/html&quot;</span><span class="ot"> pageEncoding</span>=<span class="st">&quot;UTF-8&quot;</span><span class="ot"> trimDirectiveWhitespaces</span>=<span class="st">&quot;true&quot;</span><span class="ot"> </span>%&gt;
&lt;%@ taglib<span class="ot"> prefix</span>=<span class="st">&quot;t&quot;</span><span class="ot"> tagdir</span>=<span class="st">&quot;/WEB-INF/tags&quot;</span><span class="ot"> </span>%&gt;
<span class="kw">&lt;t:pohja</span><span class="ot"> pageTitle</span>=<span class="dt">&quot;Kissalista!&quot;</span><span class="kw">&gt;</span>
    &lt;h1&gt;Hello World!&lt;/h1&gt;
<span class="kw">&lt;/t:pohja&gt;</span></code></pre>
<p>Tägitiedosto sijoittaa annetut tiedot sen mukaan mitä tägitiedostossa käsketään. Esimerkiksi kissalistan pohjatägitiedosto sijoittaa tägin sisällön navigaatioelementin viereen käyttäen Bootstrap-kirjastoa:</p>
<p><strong>pohja.tag</strong></p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;%@tag<span class="ot"> description</span>=<span class="st">&quot;Generic template for Kissalista pages&quot;</span><span class="ot"> pageEncoding</span>=<span class="st">&quot;UTF-8&quot;</span><span class="ot"> trimDirectiveWhitespaces</span>=<span class="st">&quot;true&quot;</span><span class="ot"> </span>%&gt;
&lt;%@ taglib<span class="ot"> prefix</span>=<span class="st">&quot;c&quot;</span><span class="ot"> uri</span>=<span class="st">&quot;http://java.sun.com/jsp/jstl/core&quot;</span><span class="ot"> </span>%&gt;
&lt;%@attribute<span class="ot"> name</span>=<span class="st">&quot;pageTitle&quot;</span>%&gt;
&lt;<span class="ot">!DOCTYPE html</span>&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;${pageTitle}&lt;/title&gt;
        &lt;meta<span class="ot"> http-equiv</span>=<span class="dt">&quot;Content-Type&quot;</span><span class="ot"> content</span>=<span class="dt">&quot;text/html; charset=UTF-8&quot;</span>&gt;
        &lt;link<span class="ot"> href</span>=<span class="dt">&quot;css/bootstrap.css&quot;</span><span class="ot"> rel</span>=<span class="dt">&quot;stylesheet&quot;</span>&gt;
        &lt;link<span class="ot"> href</span>=<span class="dt">&quot;css/bootstrap-theme.css&quot;</span><span class="ot"> rel</span>=<span class="dt">&quot;stylesheet&quot;</span>&gt;
        &lt;link<span class="ot"> href</span>=<span class="dt">&quot;css/main.css&quot;</span><span class="ot"> rel</span>=<span class="dt">&quot;stylesheet&quot;</span>&gt;
        &lt;script<span class="ot"> src</span>=<span class="dt">&quot;http://code.jquery.com/jquery.js&quot;</span>&gt;&lt;/script&gt;
        &lt;script<span class="ot"> src</span>=<span class="dt">&quot;js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div<span class="ot"> class</span>=<span class="dt">&quot;navbar navbar-default&quot;</span>&gt;
            &lt;div<span class="ot"> class</span>=<span class="dt">&quot;container&quot;</span>&gt;
                &lt;ul<span class="ot"> class</span>=<span class="dt">&quot;nav navbar-nav&quot;</span>&gt;
                    &lt;li<span class="ot"> class</span>=<span class="dt">&quot;active&quot;</span>&gt;&lt;a<span class="ot"> href</span>=<span class="dt">&quot;Lista&quot;</span>&gt;Lista&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a<span class="ot"> href</span>=<span class="dt">&quot;Logout&quot;</span>&gt;Kirjaudu ulos&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
            
        &lt;div<span class="ot"> class</span>=<span class="dt">&quot;container&quot;</span>&gt;
            <span class="kw">&lt;c:if</span><span class="ot"> test</span>=<span class="dt">&quot;</span>${pageError != <span class="kw">null</span>}<span class="dt">&quot;</span><span class="kw">&gt;</span>
                &lt;div<span class="ot"> class</span>=<span class="dt">&quot;alert alert-danger&quot;</span>&gt;${pageError}&lt;/div&gt;
            <span class="kw">&lt;/c:if&gt;</span>
            &lt;jsp:doBody/&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Kun yllä oleva JSP-koodi ja tägitiedosto ajetaan syntyy sivu, jonka otsikko on “Kissalista!” ja jonka sisältönä on sivunavigaatio ja Hello World -toivotus.</p>
<p>Kun sivupohja on käytössä, jokainen sivu rakentuu kerroksittain kuten tässä kaaviokuvassa: <img src="../../images/koodaaminen/template-selitys-java.png" alt="Sivupohjan, näkymän ja näkymän näyttävän koodin väliset suhteet" /></p>
<p>Kuvassa esiintyvä HTML-koodi vastaa melko tarkkaan sitä minkä Tomcat lähettää selaimelle. Huomaa, että <code>&lt;html&gt;</code>-tägi, navigaatiot yms. toistuvat elementit tarvitsee kirjoittaa vain sivupohjanana toimivaan pohja.tag-tiedostoon. Jos ne vahingossa kirjoittaa myös näkymätiedostoon, tuloksena on rikkinäistä HTML:ää:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>HTML<span class="dt">&gt;</span>
<span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;head&gt;</span>
  <span class="kw">&lt;title&gt;</span>Otsikko<span class="kw">&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;nav&gt;</span> .... <span class="kw">&lt;/nav&gt;</span>
     <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span>
<span class="dt">&lt;!DOCTYPE </span>HTML<span class="dt">&gt;</span>
<span class="kw">&lt;html&gt;</span>
<span class="kw">&lt;head&gt;</span>
  <span class="kw">&lt;title&gt;</span>Otsikko<span class="kw">&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;nav&gt;</span> .... <span class="kw">&lt;/nav&gt;</span>
     <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span>
       <span class="kw">&lt;h1&gt;</span>Otsikko<span class="kw">&lt;/h1&gt;</span>
       ...</code></pre>
<hr />
<p>Tee nyt projektillesi HTML-pohjatiedosto kansioon <code>web/WEB-INF/tags/pohja.tag</code>. Ja sijoita siihen oma sivupohjasi.</p>
<p>NetBeansistä löydät tägitiedoston uusien tiedostojen valikosta <code>Web</code>-kohdan alta nimellä <code>Tag File</code>. Voit käyttää seuraavia asetuksia:</p>
<figure>
<img src="../../images/koodaaminen/java/tagi.png" alt="Tagitiedoston luonti" /><figcaption>Tagitiedoston luonti</figcaption>
</figure>
<section id="tyylitiedostojen-linkitys" class="level3">
<h3>Tyylitiedostojen linkitys</h3>
<p>Tag-tiedostoon kannattaa laittaa linkit kaikkiin sovelluksen käyttämiin tyylitiedostoihin. Linkityksessä kannattaa käyttää <a href="../..//suunnittelu_ja_tyoymparisto/kayttoliittyman_toteutus.html#linkitys">relatiivisia osoitteita</a>, jolloin sovellus toimii riippumatta siitä mihin osoitteeseen se pystytetään.</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">&quot;css/main.css&quot;</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="kw">&gt;</span></code></pre>
<p>Mikäli sovelluksesi osoitteiden hakemistorakenne on kuitenkin monitasoinen, joudut käyttämään erityistä osoitemuuttujaa, joka osoittaa aina sovelluksesi juuren osoitteseen:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;link<span class="ot"> href</span>=<span class="dt">&quot;</span>${pageContext.request.contextPath}<span class="dt">/css/main.css&quot;</span><span class="ot"> rel</span>=<span class="dt">&quot;stylesheet&quot;</span>&gt;</code></pre>
<p>Tietokantasovelluksen kokoisissa nettisovelluksissa ylläolevan tapaisen funktion kirjoittaminen on kuitenkin harvoin tarpeellista, sillä relatiiviset osoitteet riittävät yleensä hyvin.</p>
</section>
</section>
<section id="tyhjien-rivien-trimmaaminen" class="level2">
<h2>Tyhjien rivien trimmaaminen</h2>
<p>JSP-koodiin upotetuilla tägeillä on ikävä tapa jättää valmis HTML-koodi täyteen tyhjiä rivejä. Tämä on ongelmallista etenkin HTML:n dokumenttien alun osalta, sillä standardin mukaisen HTML-koodin ensimmäisen rivin pitäisi sisältää <code>&lt;!DOCTYPE&gt;</code>-tägi, jotta selaimet näyttäisivät sivun standardin mukaisesti oikein.</p>
<p>Tähän on onneksi JSP:ssä valmiina ratkaisu. JSP-tiedoston ensimmäisellä rivillä olevalle <code>&lt;%@page&gt;</code>-tägille pitää vain lisätä attribuutti <code>trimDirectiveWhitespaces</code>:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;%@page<span class="ot"> contentType</span>=<span class="st">&quot;text/html&quot;</span><span class="ot"> pageEncoding</span>=<span class="st">&quot;UTF-8&quot;</span><span class="ot"> trimDirectiveWhitespaces</span>=<span class="st">&quot;true&quot;</span><span class="ot"> </span>%&gt;</code></pre>
<p>Sama temppu on tehtävä myös tag-tiedoston ensimmäisellä rivillä olevalle <code>&lt;%@tag&gt;</code>-tägille:</p>
<pre class="sourceCode jsp"><code class="sourceCode jsp">&lt;%@tag<span class="ot"> description</span>=<span class="st">&quot;Generic template for Kissalista pages&quot;</span><span class="ot"> pageEncoding</span>=<span class="st">&quot;UTF-8&quot;</span><span class="ot"> trimDirectiveWhitespaces</span>=<span class="st">&quot;true&quot;</span><span class="ot"> </span>%&gt;</code></pre>
<p>Attribuutin laittamisen seurauksena kaikki ylimääräiset tulostumattomat merkit (nk. whitespace) jätetään valmiista HTML-koodista pois, jolloin tuloksena on standardinmukaista HTML:ää.</p>
</section>
<section id="toistuva-koodi-kannattaa-laittaa-omaan-luokkaansa" class="level2">
<h2>Toistuva koodi kannattaa laittaa omaan luokkaansa</h2>
<p>Siinä vaiheessa kun servlet-luokkia alkaa tulla projektiin useampia alkavat tietyt toiminnot toistua luokasta toiseen. Hyvänä esimerkkinä JSP-sivun näyttämiseen tarvittu koodinpätkä, virheilmoitusten lähettäminen näkymälle näkyviin, ja kirjautumisen tarkistaminen.</p>
<p>Tee itsellesi uusi luokka, ja lähde rakentamaan siihen yleisiä toiminnallisuuksia omina metodeinaan. Laita siihen ensimmäiseksi metodi, jolla saat näytettyä JSP-sivun. Kehittele myös tapa näyttää sivupohjassasi sovelluksen virheitä ja tee metodi joka aktivoi tuon tavan. Useimmiten tähän kannattaa käyttää <code>setAttribute</code>-metodia ja jotain sovittua attribuuttia, jonka arvo näytetään virheviestinä.</p>
<p>Voit laittaa uuden luokkasi perimään HttpServletin ja periyttää kaikki muut servlettisi siitä. Näin luokkasi metodit ovat kaikissa projektisi servlet-luokissa suoraan käytettävissä.</p>
</section>
<section id="linkkejä" class="level2">
<h2>Linkkejä</h2>
<ul>
<li><a href="http://www.sitepoint.com/java-standard-tag-library/">Introduction to the Java Standard Tag Library</a></li>
</ul>
<section class="alert alert-success small"><h3>
Seuraavaksi:
</h3>
<p>Seuraavaksi otamme käyttäjämallin, JSP-sivut ja servletit käyttöön <a href="lomakkeet.html">yksinkertaisen kirjautumisen</a> toteuttamiseen.</p>
</section>
</section>
</div>
</div> 
</div> 
<footer>
  <a href="../../sivukartta.html">Sivukartta</a> - 
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>

