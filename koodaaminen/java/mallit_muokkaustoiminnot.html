<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Malliluokat ja tiedon muuttaminen</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="../../javascript/jquery.min.js"></script>
  <script src="../../javascript/bootstrap.js"></script>
  <script src="../../javascript/jquery.treeview.js"></script>
  <script src="../../javascript/jquery.scrollTo.js"></script>
  <script src="../../javascript/jquery.nav.js"></script>
  <script src="../../javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/index.html">Viikottaiset palautukset</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/esittelysivu.html">Työn esittelysivu</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko1.html">Viikko 1</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko2.html">Viikko 2</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko3.html">Viikko 3</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko4.html">Viikko 4</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko5.html">Viikko 5</a></li>
</ul></li>
<li><a href="../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../suunnittelu/index.html">Työn suunnittelu</a>
<ul>
<li><a href="../../suunnittelu/aiheet/index.html">Työaiheet</a>
<ul>
<li><a href="../../suunnittelu/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../suunnittelu/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../suunnittelu/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../suunnittelu/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../suunnittelu/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../suunnittelu/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../suunnittelu/aiheet/Keskustelufoorumi.html">Keskustelufoorumi</a></li>
<li><a href="../../suunnittelu/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../suunnittelu/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../suunnittelu/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../suunnittelu/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../suunnittelu/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../suunnittelu/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../suunnittelu/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../suunnittelu/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../suunnittelu/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../suunnittelu/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../suunnittelu/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../suunnittelu/aiheet/Pokemon-kanta.html">Pokémon-tietokanta</a></li>
<li><a href="../../suunnittelu/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../suunnittelu/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../suunnittelu/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../suunnittelu/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../suunnittelu/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../suunnittelu/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../suunnittelu/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../suunnittelu/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../suunnittelu/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../suunnittelu/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../suunnittelu/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../suunnittelu/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../suunnittelu/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../suunnittelu/tietokannan-valinta.html">Tietokannan valinta</a></li>
<li><a href="../../suunnittelu/kayttoliittyma.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../suunnittelu/tietokanta.html">Tietokannan suunnittelu</a></li>
</ul></li>
<li><a href="../../pystytys/index.html">Users-palvelin ja töiden pystyttäminen</a>
<ul>
<li><a href="../../pystytys/kayttoonotto/index.html">Palvelujen käynnistäminen ja käyttöönotto</a>
<ul>
<li><a href="../../pystytys/kayttoonotto/java.html">Java ja Tomcatin käyttöönotto</a></li>
<li><a href="../../pystytys/kayttoonotto/mysql.html">MySql-tietokannan käyttöönotto</a></li>
<li><a href="../../pystytys/kayttoonotto/php.html">PHP-tuen käyttöönotto</a></li>
<li><a href="../../pystytys/kayttoonotto/postgresql.html">PostgreSQL-tietokannan käyttöönotto</a></li>
</ul></li>
<li><a href="../../pystytys/netbeans/index.html">NetBeansin käyttöönotto</a>
<ul>
<li><a href="../../pystytys/netbeans/java.html">NetBeansin käyttö Javan kanssa</a></li>
<li><a href="../../pystytys/netbeans/php.html">NetBeansin käyttö PHP:n kanssa</a></li>
<li><a href="../../pystytys/netbeans/keyring-reset.html">Unlock your keyring? - Avainnippujen nollaus</a></li>
</ul></li>
<li><a href="../../pystytys/postgres-ssh-tunneli.html">PostgreSql-kannan etäkäyttö</a></li>
<li><a href="../../pystytys/java-war-paketit.html">Kotikoneella tehdyn Java-työn julkaisu</a></li>
<li><a href="../../pystytys/php-virheet.html">PHP:n virheilmoitusten katselu</a></li>
<li><a href="../../pystytys/nautilus-ssh.html">Tiedostojen etämuokkaus Linuxilla</a></li>
</ul></li>
<li><a href="../../koodaaminen/index.html">Ohjelmointiohjeistus</a>
<ul>
<li><a href="../../koodaaminen/html-opas.html">HTML-opas</a></li>
<li><a href="../../koodaaminen/kannan-alustus.html">Tietokantataulujen pystyttäminen</a></li>
<li><a href="../../koodaaminen/testisovellus.html">ConnectionTest-testisovellus</a></li>
<li><a href="../../koodaaminen/tietokantayhteys/index.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/git-ja-salasanat.html">Git-repositoriot ja salasanat</a></li>
<li><a href="../../koodaaminen/listaustesti/index.html">Yksinkertainen tietokantalistaus</a>
<ul>
<li><a href="../../koodaaminen/listaustesti/java.html">Listaus Javalla</a></li>
<li><a href="../../koodaaminen/listaustesti/php.html">Listaus PHP:llä</a></li>
</ul></li>
<li><a href="../../koodaaminen/arkkitehtuuri/index.html">Arkkitehtuuri ja MVC</a>
<ul>
<li><a href="../../koodaaminen/arkkitehtuuri/nyrkkisaannot.html">MVC-mallin nyrkisääntöjä</a></li>
</ul></li>
<li><a href="../../koodaaminen/java/index.html">Java-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li><a href="../../koodaaminen/java/nakymat.html">Näkymien tekeminen ja JSP</a></li>
<li><a href="../../koodaaminen/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/java/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li class="selected"><a href="../../koodaaminen/java/mallit_muokkaustoiminnot.html">Malliluokat ja tiedon muuttaminen</a></li>
<li><a href="../../koodaaminen/java/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
</ul></li>
<li><a href="../../koodaaminen/php/index.html">PHP-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/php/rakenne.html">Sovelluksen rakenne ja kontrollerit</a></li>
<li><a href="../../koodaaminen/php/nakymat.html">Näkymien tekeminen</a></li>
<li><a href="../../koodaaminen/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/php/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/php/mallit_muokkaustoiminnot.html">Malliluokat ja tiedon muuttaminen</a></li>
<li><a href="../../koodaaminen/php/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
</ul></li>
</ul></li>
<li><a href="../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../sivukartta.html">Sivukartta</a></li>
<li><a href="../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Malliluokat ja tiedon muuttaminen</h1>
</header>
<!-- order: 6 -->


<div class="wip panel">
  <div class="panel-body">
    <h3>
Work in progress
</h3>
    
Tämän sivun sisältö on vielä työn alla ja saattaa muuttua kurssin edetessä.
</div>
</div>



<p>Tämän sivun Java-versio on valitettavasti tällä hetkellä vielä klooni PHP-versiosta.</p>
<section class="alert alert-info"><h3>
Tiivistelmä:
</h3>
<ul>
<li>Malliluokan oliolla kannattaa olla metodi, jolla se osaa syöttää itsensä kantaan (INSERT-lause), sekä metodit, joilla tarkistetaan ovatko syötettävät arvot oikeanlaisia.</li>
<li>Päivittämiseen tarvitaan vastaavaa metodia, joka ajaa UPDATE-lauseen</li>
<li>samoin poistamiselle on tarpeen DELETE-lauseen ajava instanssimetodi.</li>
</ul>
</section>

<section id="tietojen-syöttäminen-olioon" class="level2">
<h2>Tietojen syöttäminen olioon</h2>
<p>Paras tapa toteuttaa jonkin tietokohteen olion, esimerkiksi kissan, syöttäminen tietokantaan, on tehdä siitä oliopohjaista: Ensiksi luodaan kissaolio, jonka jälkeen asetetaan sille settereillä sopivat arvot. Kun olio on luotu, kutsutaan varta vasten tätä tarkoitusta varten tehtyä metodia, joka lisää olion kantaan. Mallia kutsuva koodi voisi näyttää seuraavanlaiselta:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">$uusikatti</span> = <span class="kw">new</span> Kissa<span class="ot">();</span>
<span class="kw">$uusikatti</span>-&gt;setNimi<span class="ot">(</span><span class="kw">$_POST</span><span class="ot">[</span><span class="st">&#39;nimi&#39;</span><span class="ot">]);</span>
<span class="kw">$uusikatti</span>-&gt;setVari<span class="ot">(</span><span class="kw">$_POST</span><span class="ot">[</span><span class="st">&#39;vari&#39;</span><span class="ot">]);</span>
<span class="kw">$uusikatti</span>-&gt;setRotuId<span class="ot">(</span><span class="kw">$_POST</span><span class="ot">[</span><span class="st">&#39;rotu_id&#39;</span><span class="ot">]);</span>

<span class="co">//Pyydetään Kissa-oliota tarkastamaan syötetyt tiedot.</span>
<span class="kw">if</span> <span class="ot">(</span><span class="kw">$uusikatti</span>-&gt;onkoKelvollinen<span class="ot">())</span> {
  <span class="kw">$uusikatti</span>-&gt;lisaaKantaan<span class="ot">();</span>
  
  <span class="co">//Kissa lisättiin kantaan onnistuneesti, lähetetään käyttäjä eteenpäin</span>
  <span class="fu">header</span><span class="ot">(</span><span class="st">&#39;Location: kissalista.php&#39;</span><span class="ot">);</span>
  <span class="co">//Asetetaan istuntoon ilmoitus siitä, että kissa on lisätty.</span>
  <span class="co">//Tästä tekniikasta kerrotaan lisää seuraavalla sivulla</span>
  <span class="kw">$_SESSION</span><span class="ot">[</span><span class="st">&#39;ilmoitus&#39;</span><span class="ot">]</span> = <span class="st">&quot;Kissa lisätty onnistuneesti.&quot;</span><span class="ot">;</span>
} <span class="kw">else</span> {
  <span class="kw">$virheet</span> = <span class="kw">$uusikatti</span>-&gt;getVirheet<span class="ot">();</span>

  <span class="co">//Virheet voidaan nyt välittää näkymälle syötettyjen tietojen kera</span>
  naytaNakymä<span class="ot">(</span><span class="st">&quot;kissalomake&quot;</span><span class="ot">,</span> <span class="fu">array</span><span class="ot">(</span>
    <span class="st">&#39;kissa&#39;</span> =&gt; <span class="kw">$uusikatti</span><span class="ot">,</span>
    <span class="st">&#39;virheet&#39;</span> =&gt; <span class="kw">$virheet</span>
  <span class="ot">));</span>
}</code></pre>
<p>Huomaa käytetyt metodi <code>onkoKelvollinen</code> ja <code>getVirheet</code>, joista ensimmäinen kertoo, ovatko olioon asetetut tiedot tiedot oikeat ja jälkimmäinen palauttaa kaikki olion tietoihin liittyvät virheet.</p>
<p>Etenkin jälkimmäisen toteuttamisesta on paljon hyötyä lisäyslomakkeen virheviestien toteuttamisessa.</p>
<p>Nämä metodit voi toteuttaa käytännössä kahdella tavalla riippuen siitä missä tarkistuksen haluaa tehdä:</p>
<ol type="1">
<li>Laitetaan tarkistukset suoraan settereihin ja pidetään jatkuvasti yllä tietorakennetta siitä mitkä tiedot ovat kelvollisia.</li>
<li>Laitetaan tarkistukset <code>onkoKelvollinen</code>-metodiin ja tarkistetaan kaikki kentät kerralla.</li>
</ol>
<p>Ensimmäinen toteutustapa on usein selkeämpi, sillä yhtä kenttää koskevat toiminnot pysyvät yhdessä paikassa, mutta jälkimmäisellä tavalla on joskus mahdollista automatisoida toistuvia tarkistuksia hieman paremmin laittamalla toisteista koodia luuppeihin.</p>
<p>Alla esimerkki siitä miten virheentarkistuksen voi toteuttaa settereillä, jotka muokkaavat privaattikentäksi määriteltyä virhetaulukkoa.</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">class</span> Kissa {
  <span class="kw">private</span> <span class="kw">$virheet</span> = <span class="fu">array</span><span class="ot">();</span>

  <span class="kw">public</span> <span class="kw">function</span> setNimi<span class="ot">(</span><span class="kw">$uusinimi</span><span class="ot">)</span> {
    <span class="kw">$this</span>-&gt;nimi = <span class="kw">$uusinimi</span><span class="ot">;</span>

    <span class="kw">if</span> <span class="ot">(</span><span class="fu">trim</span><span class="ot">(</span><span class="kw">$this</span>-&gt;nimi<span class="ot">)</span> == <span class="st">&#39;&#39;</span><span class="ot">)</span> {
      <span class="kw">$this</span>-&gt;virheet<span class="ot">[</span><span class="st">&#39;nimi&#39;</span><span class="ot">]</span> = <span class="st">&quot;Nimi ei saa olla tyhjä.&quot;</span><span class="ot">;</span>
    } <span class="kw">else</span> { 
      <span class="fu">unset</span><span class="ot">(</span><span class="kw">$this</span>-&gt;virheet<span class="ot">[</span><span class="st">&#39;nimi&#39;</span><span class="ot">]);</span>
    }
  }
  <span class="kw">public</span> <span class="kw">function</span> setVari<span class="ot">(</span><span class="kw">$uusivari</span><span class="ot">)</span> {
    <span class="kw">$this</span>-&gt;vari = <span class="kw">$uusivari</span><span class="ot">;</span>

    <span class="kw">if</span> <span class="ot">(</span><span class="fu">trim</span><span class="ot">(</span><span class="kw">$this</span>-&gt;vari<span class="ot">)</span> == <span class="st">&#39;&#39;</span><span class="ot">)</span> {
      <span class="kw">$this</span>-&gt;virheet<span class="ot">[</span><span class="st">&#39;vari&#39;</span><span class="ot">]</span> = <span class="st">&quot;Kissalla on oltava väri.&quot;</span><span class="ot">;</span>
    } <span class="kw">else</span> { 
      <span class="fu">unset</span><span class="ot">(</span><span class="kw">$this</span>-&gt;virheet<span class="ot">[</span><span class="st">&#39;vari&#39;</span><span class="ot">]);</span>
    }
  }
  <span class="kw">public</span> <span class="kw">function</span> setRotuId<span class="ot">(</span><span class="kw">$uusirotu_id</span><span class="ot">)</span> {
    <span class="kw">$this</span>-&gt;rotu_id = <span class="kw">$uusirotu_id</span><span class="ot">;</span>
    
    <span class="co">//Tarkistetaan, että rotu on olemassa</span>
    <span class="kw">if</span> <span class="ot">(</span>Kissarotu::etsi<span class="ot">(</span><span class="kw">$uusirotu_id</span><span class="ot">)</span> == <span class="kw">null</span><span class="ot">)</span> {
      <span class="kw">$this</span>-&gt;rotu_id = <span class="kw">null</span><span class="ot">;</span>
    }

    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$this</span>-&gt;rotu_id == <span class="kw">null</span><span class="ot">)</span> {
      <span class="kw">$this</span>-&gt;virheet<span class="ot">[</span><span class="st">&#39;rotu_id&#39;</span><span class="ot">]</span> = <span class="st">&quot;Kissan rotua ei löytynyt tietokannasta&quot;</span><span class="ot">;</span>
    } <span class="kw">else</span> { 
      <span class="fu">unset</span><span class="ot">(</span><span class="kw">$this</span>-&gt;virheet<span class="ot">[</span><span class="st">&#39;rotu_id&#39;</span><span class="ot">]);</span>
    }
  }

  <span class="co">/* Palauttaa true, jos Kissaan syötetyt arvot ovat järkeviä. */</span>
  <span class="kw">public</span> <span class="kw">function</span> onkoKelvollinen<span class="ot">()</span> {
    <span class="kw">return</span> <span class="fu">empty</span><span class="ot">(</span><span class="kw">$this</span>-&gt;virheet<span class="ot">);</span>
  }
  <span class="kw">public</span> <span class="kw">function</span> getVirheet<span class="ot">()</span> {
    <span class="kw">return</span> this-&gt;virheet<span class="ot">;</span>
  }</code></pre>
<p>Huomaa toiseen tauluun viittaavan tiedon setterissä (<code>setRotuId</code>) oleva toista mallia käyttävä tietokantahaku, joka tarkistaa, että viitattu tieto on olemassa.</p>
<p>Mallien välinen viittailu on myös mahdollista rakentaa siten, että sille voidaan antaa setterissä toisen taulun olioita, joista poimitaan id.</p>
<section id="olion-syöttäminen-kantaan" class="level3">
<h3>Olion syöttäminen kantaan</h3>
<ul>
<li>Autogeneroituja id-numeroita (esim. PostgreSQL:n <a href="http://www.postgresql.org/docs/9.2/static/datatype-numeric.html#DATATYPE-SERIAL">SERIAL-tietotyyppi</a>) varten olemassa omat kikkansa:
<ul>
<li>PostgreSQL:llä voidaan INSERT-lauseen jälkeen laittaa käsky <code>RETURNING id</code>, jolloin kysely palauttaa kentän <code>id</code> arvon ikään kuin se olisi SELECT-kysely.</li>
<li>MySQL:llä olemassa PHP:llä PDO:n <a href="http://php.net/manual/en/pdo.lastinsertid.php">lastInsertId-metodi</a>.</li>
<li>Javalle olemassa <a href="http://www.technicalkeeda.com/details/how-to-get-mysql-auto-increment-key-value-using-java-jdbc">vastaava tekniikka</a>.</li>
<li>SERIAL-tyyppiä käytettäessä INSERT-lauseeseen ei laiteta id-avaimelle lainkaan arvoa, jolloin kanta laittaa kenttään seuraavan vapaan arvon.</li>
</ul></li>
</ul>
<p><strong>Esimerkkikoodia:</strong></p>
<pre class="sourceCode php"><code class="sourceCode php">  <span class="kw">public</span> <span class="kw">function</span> lisaaKantaan<span class="ot">()</span> {
    <span class="kw">$sql</span> = <span class="st">&quot;INSERT INTO Kissat(nimi, vari, rotu_id) VALUES(?,?,?) RETURNING id&quot;</span><span class="ot">;</span>
    <span class="kw">$kysely</span> = getTietokanta<span class="ot">()</span>-&gt;prepare<span class="ot">(</span><span class="kw">$sql</span><span class="ot">);</span>

    <span class="kw">$ok</span> = <span class="kw">$kysely</span>-&gt;execute<span class="ot">(</span><span class="fu">array</span><span class="ot">(</span><span class="kw">$this</span>-&gt;getNimi<span class="ot">(),</span> <span class="kw">$this</span>-&gt;getVari<span class="ot">(),</span> <span class="kw">$this</span>-&gt;getRotuId<span class="ot">()));</span>
    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$ok</span><span class="ot">)</span> {
      <span class="co">//Haetaan RETURNING-määreen palauttama id.</span>
      <span class="co">//HUOM! Tämä toimii ainoastaan PostgreSQL-kannalla!</span>
      <span class="kw">$this</span>-&gt;id = <span class="kw">$kysely</span>-&gt;fetchColumn<span class="ot">();</span>
    }
    <span class="kw">return</span> <span class="kw">$ok</span><span class="ot">;</span>
  }</code></pre>
</section>
</section>
<section id="muokkauksen-toteuttaminen" class="level2">
<h2>Muokkauksen toteuttaminen</h2>
<p>Tämä tapahtuu pitkälti samalla tavalla kuin tiedon lisääminen. Toteutukseessa on järkevää käyttää samaa tietojen kelpoisuuden tarkistamismekanismia, kuin lisäämisen kanssa.</p>
</section>
<section id="muuta" class="level2">
<h2>Muuta</h2>
<ul>
<li>Luokalla voi olla staattisia metodeja, joilla voi hakea olioita eli rivejä kannasta.
<ul>
<li>Voi tehdä myös instassimetodeja, jotka hakevat johonkin olioon liittyviä rivejä toisista tietokantatauluista.</li>
</ul></li>
<li>Tarvitaan myös metodi(t), jolla voi poistaa rivejä.
<ul>
<li>Instanssimetodi poistaa kyseisen olion kannasta.</li>
<li>Staattisella metodilla voi poistaa useitakin olioita.</li>
</ul></li>
</ul>
<section class="alert alert-success small"><h3>
Seuraavaksi:
</h3>
<p>Kun malli on toteutettu, sitä voi käyttää <a href="muokkausnakymat.html">muokkaus- ja lisäyslomakkeiden tekemiseen</a>.</p>
</section>




</section>
</div>
</div> 
</div> 
<footer>
  <a href="../../sivukartta.html">Sivukartta</a> - 
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>
