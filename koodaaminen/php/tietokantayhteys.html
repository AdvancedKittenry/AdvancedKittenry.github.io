<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Tietokantayhteyden pystytys</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../css/base.css">
  <link rel="icon" href="../../images/kissa.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="../../javascript/jquery.min.js"></script>
  <script src="../../javascript/bootstrap.js"></script>
  <script src="../../javascript/jquery.treeview.js"></script>
  <script src="../../javascript/jquery.scrollTo.js"></script>
  <script src="../../javascript/jquery.nav.js"></script>
  <script src="../../javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/index.html">Viikottaiset palautukset</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/esittelysivu.html">Työn esittelysivu</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko1.html">Viikko 1</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko2.html">Viikko 2</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko3.html">Viikko 3</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko4.html">Viikko 4</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko5.html">Viikko 5</a></li>
</ul></li>
<li><a href="../../aikataulu/koodikatselmointi.html">Koodikatselmointi</a></li>
<li><a href="../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/index.html">Työn suunnittelu ja työympäristön pystytys</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/index.html">Työaiheet</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Henkilogalleria.html">Henkilögalleria</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Keskustelufoorumi.html">Keskustelufoorumi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Pokemon-kanta.html">Pokémon-tietokanta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/tietokannan-valinta.html">Tietokannan valinta</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/git.html">Versionhallinnan käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/alkudokumentointi.html">Perusasioiden dokumentointi</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/index.html">Users-palvelin ja töiden pystyttäminen</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/java.html">Java ja Tomcatin käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/php.html">PHP-tuen käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/mysql.html">MySql-tietokannan käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/postgresql.html">PostgreSQL-tietokannan käyttöönotto</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/users/postgres-ssh-tunneli.html">PostgreSql-kannan etäkäyttö</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/index.html">NetBeansin käyttöönotto</a>
<ul>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/java.html">NetBeansin käyttö Javan kanssa</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/php.html">NetBeansin käyttö PHP:n kanssa</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/netbeans/keyring-reset.html">Unlock your keyring? - Avainnippujen nollaus</a></li>
</ul></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/etamuokkaus.html">Tiedostojen etämuokkaus Linuxilla</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/kayttoliittyma.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/kayttoliittyman_toteutus.html">Käyttöliittymädemon toteuttaminen</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/tietokanta.html">Tietokannan suunnittelu</a></li>
<li><a href="../../suunnittelu_ja_tyoymparisto/tietokanta-dokumentointi.html">Tietokannan dokumentointi</a></li>
</ul></li>
<li><a href="../../koodaaminen/index.html">Ohjelmointiohjeistus</a>
<ul>
<li><a href="../../koodaaminen/kannan-alustus.html">Tietokantataulujen pystyttäminen</a></li>
<li><a href="../../koodaaminen/testisovellus.html">ConnectionTest-testisovellus</a></li>
<li><a href="../../koodaaminen/git-ja-salasanat.html">Git-repositoriot ja salasanat</a></li>
<li><a href="../../koodaaminen/arkkitehtuuri/index.html">Arkkitehtuuri ja MVC</a>
<ul>
<li><a href="../../koodaaminen/arkkitehtuuri/nyrkkisaannot.html">MVC-mallin nyrkisääntöjä</a></li>
</ul></li>
<li><a href="../../koodaaminen/java/index.html">Java-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/java/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/java/listaustesti.html">Listaustesti</a></li>
<li><a href="../../koodaaminen/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li><a href="../../koodaaminen/java/nakymat.html">Näkymien tekeminen ja JSP</a></li>
<li><a href="../../koodaaminen/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/java/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/java/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../../koodaaminen/java/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../../koodaaminen/java/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../../koodaaminen/java/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
<li><a href="../../koodaaminen/java/java-war-paketit.html">Kotikoneella tehdyn Java-työn julkaisu</a></li>
<li><a href="../../koodaaminen/java/tomcatin-korjaaminen.html">Tomcatin ongelmien ratkominen</a></li>
</ul></li>
<li><a href="../../koodaaminen/php/index.html">PHP-ohjeet</a>
<ul>
<li class="selected"><a href="../../koodaaminen/php/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/php/listaustesti.html">Listaustesti</a></li>
<li><a href="../../koodaaminen/php/rakenne.html">Sovelluksen rakenne ja kontrollerit</a></li>
<li><a href="../../koodaaminen/php/nakymat.html">Näkymien tekeminen</a></li>
<li><a href="../../koodaaminen/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/php/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/php/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../../koodaaminen/php/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../../koodaaminen/php/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../../koodaaminen/php/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
<li><a href="../../koodaaminen/php/syntaksiopas.html">Lyhyt PHP-opas Java-koodarille</a></li>
<li><a href="../../koodaaminen/php/php-virheet.html">PHP:n virheilmoitusten katselu</a></li>
</ul></li>
</ul></li>
<li><a href="../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../sivukartta.html">Sivukartta</a></li>
<li><a href="../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Tietokantayhteyden pystytys</h1>
</header>
<!-- order: 1 -->
<!-- tags: viikko2-php -->
<section class="alert alert-info">
<h3>
Tiivistelmä:
</h3>
<ul>
<li>Varmista että aikaisemmin kirjoittamasi SQL-lauseet toimivat siten tietokantataulusi ovat nyt pystyssä kannassa.</li>
<li>Jotta tietokantaa pystyy käyttämään, pitää siihen ottaa yhteys
<ul>
<li>Yhteyttä mallinnetaan PHP:n PDO-tietokantakirjaston tarjoamalla oliolla.</li>
<li>Luominen pitää sijoittaa omaan funktioonsa tai metodiinsa, jota käyttämällä muu ohjelmakoodi voi hakea tietokantaolion.</li>
<li>Metodi sijoitetaan omaan tiedostoonsa, joka sijoitetaan omaan tietokantakirjastoille tarkoitettuun hakemistoonsa.</li>
</ul></li>
<li>Toteuta ensiksi mahdollisimman yksinkertainen testiohjelma, joka hakee tietokannasta tietoa</li>
<li>Jos käytät tietokantayhteyden autentikointiin salasanaa, <a href="../git-ja-salasanat.html">älä laita sitä GitHubiin sellaisenaan</a>.</li>
</ul>
</section>
<p>Sekä Javalla että PHP:llä tietokantayhteyksiä edustaa erillinen luokka, jonka olio muodostetaan kutsumalla sopivaa metodia/konstruktoria. Kummallekin annetaan merkkijonona tietokantayhteyttä kuvaava osoite, jonka perusteella yhteys muodostetaan.</p>
<p>Alla on esimerkkikoodia tietokantayhteyden muodostamisesta tilanteessa, jossa työ pyörii users-palvelimella. Koodin tarkoituksena on toteuttaa mahdollisimman yksinkertainen ohjelma, joka ottaa yhteyden tietokantaan ja suorittaa siellä SQL-muotoisen SELECT-lauseen, jonka tulos näytetään käyttäjälle.</p>
<p>Tee itsellesi ohjeita noudattaen tiedosto, johon sijoitat tietokannan muodostamisen. Laita tämä tiedosto omaan kansioonsa. Hyviä nimiä hakemistolle voivat olla esim. “tietokanta” tai “models”. Sovelluksesta tulee huomattavasti selkeämpi, jos kaikki tietokantaa käsittelevä koodi on sijoitettu yhteen paikkaan.</p>
<section id="tietokantayhteys-ja-php-data-objects-php" class="level2">
<h2>Tietokantayhteys ja PHP Data Objects (PHP)</h2>
<p>PHP:ssä käytössä oleva tietokantakirjasto on nimeltään PHP Data Objects eli PDO. Otamme tämän kirjaston nyt testiluontoisesti käyttöön.</p>
<p>Sijoita allaolevat koodit ensiksi omaan testausta varten tekemääsi tiedostoon, esim. <code>yhteystesti.php</code>.</p>
<p>Yhteyden avaaminen onnistuu seuraavalla tavalla.</p>
<p><strong>yhteystesti.php</strong></p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">&lt;?php</span>
<span class="co">//Tietokannan tunnukset:</span>
<span class="kw">$tunnus</span> = <span class="st">&quot;kayttajatunnuksesi&quot;</span><span class="ot">;</span>
<span class="kw">$salasana</span>= <span class="st">&quot;psql-salasana&quot;</span><span class="ot">;</span>

<span class="co">//Yhteysolion luominen</span>
<span class="kw">$yhteys</span> = <span class="kw">new</span> <span class="kw">PDO</span><span class="ot">(</span><span class="st">&quot;pgsql:host=localhost;port=5432;dbname=</span><span class="kw">$tunnus</span><span class="st">&quot;</span><span class="ot">,</span> <span class="kw">$tunnus</span><span class="ot">,</span> <span class="kw">$salasana</span><span class="ot">);</span></code></pre>
<p>Jos käytät PostgreSQL:ää users-palvelimella, voit käyttää myös lyhyempää yhteysosoitetta, johon ei laiteta salasanaa:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">$yhteys</span> = <span class="kw">new</span> <span class="kw">PDO</span><span class="ot">(</span><span class="st">&quot;pgsql:&quot;</span><span class="ot">);</span></code></pre>
<p>Seuravaa komento pyytää PDO:ta tuottamaan poikkeuksen aina kun jossain on virhe. Sitä kannattaa käyttää aina, oletuksena PDO ei nimittäin raportoi virhetiloja juuri mitenkään!</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">$yhteys</span>-&gt;setAttribute<span class="ot">(</span><span class="kw">PDO</span>::<span class="kw">ATTR_ERRMODE</span><span class="ot">,</span><span class="kw">PDO</span>::<span class="kw">ERRMODE_EXCEPTION</span><span class="ot">);</span></code></pre>
<section class="alert alert-danger">
<h3>
Pidä mielessä!
</h3>
<p>Jos käytät koodista ensimäistä versiota, joka tarvitsee salasanan, älä laita sitä repositorioosi suoraan. Käytä sen sijaan <a href="../git-ja-salasanat.html">dist-tiedostoja</a>.</p>
<p>Salasanojen laittaminen julkiseen git-repositorioon on yleisesti ottaen tietoturvan kannalta paha tapa, joten sitä kannattaa välttää aina kun mahdollista.</p>
</section>
<section id="phpn-omituinen-oliosyntaksi" class="level3">
<h3>PHP:n omituinen oliosyntaksi</h3>
<p>PHP:n oliosyntaksi on valitettavasti sekavampi kuin Javan käyttämä. Metodien kutsumiseen käytetään syntaksia <code>$olio-&gt;metodi();</code>, olion atribuutteja käytetään samaan tapaan <code>$olio-&gt;attribuutti</code>.</p>
<p>Sensijaan jos metodi, attribuutti, tai <em>vakio</em> on staattinen käytetään kahta kaksoispistettä ja atribuutin tapauksessa vielä dollaria:</p>
<table class="table table-striped table-bordered">
<tbody>
<tr class="odd">
<td style="text-align: left;">Staattinen metodi</td>
<td style="text-align: left;"><code>LuokanNimi::staattinenMetodi()</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Staattinen attribuutti</td>
<td style="text-align: left;"><code>LuokanNimi::$attribuutti</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Staattinen vakio</td>
<td style="text-align: left;"><code>LuokanNimi::VAKION_NIMI</code></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="yhteyden-testaaminen" class="level2">
<h2>Yhteyden testaaminen</h2>
<p>Kun yhteys on muodostettu, sitä voi käyttää SQL-kyselyjen suorittamiseen. Tehdään tätä varten lyhyt testiohjelma.</p>
<p>Tietokannan nopeaan testaamisen voi käyttää seuraavanlaista koodia, jonka voi sijoittaa suoraan yllä esitetyn yhteyden muodotamisen perään:</p>
<p><strong>yhteystesti.php</strong></p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="co">//Alustetaan muuttuja jossa on Select-kysely, joka palauttaa lukuarvon:</span>
<span class="kw">$sqlkysely</span> = <span class="st">&quot;SELECT 1+1 as two&quot;</span><span class="ot">;</span>

<span class="co">//Pyydetään PDO-yhteysoliota käsittelemään SQL-muotoinen kysely.</span>
<span class="co">//Huom! PHP:ssä käytetään syntaksia $olio-&gt;metodi(); metodien kutsumiseen.</span>
<span class="kw">$kysely</span> = <span class="kw">$yhteys</span>-&gt;prepare<span class="ot">(</span><span class="kw">$sqlkysely</span><span class="ot">);</span>


<span class="kw">if</span> <span class="ot">(</span><span class="kw">$kysely</span>-&gt;execute<span class="ot">())</span> {
  <span class="co">//Tulos-muuttujan arvoksi pitäisi tulla numero kaksi.</span>
  <span class="kw">$tulos</span> = <span class="kw">$kysely</span>-&gt;fetchColumn<span class="ot">();</span>

  <span class="co">//var_dump tulostaa muuttujan tyypin ja arvon käyttäjälle:</span>
  <span class="fu">var_dump</span><span class="ot">(</span><span class="kw">$tulos</span><span class="ot">);</span>
}</code></pre>
<p>Koodin pitäisi tulostaa seuraava teksti debug-koodaukseen tarkoitettua <a href="http://php.net/manual/en/function.var-dump.php">var_dump</a>-funktiota käyttäen:</p>
<pre><code>int(2)</code></pre>
<p>Kun olet saanut saanut yhteyden toimimaan ja palauttamaan kannasta tietoa, tee yhteyden muodostamista varten oma tiedostonsa ja luo sitä ja muita tietokantaan liittyviä tiedostoja varten oma hakemistonsa, jonka nimi voi olla vaikkapa <code>libs</code> tai <code>kirjastot</code>. Tähän tiedostoon sijoitetaan joko luokkaan tai funktioon yllä esitetty yhteyskoodi.</p>
<p>Huomaa, että on tärkeää, että yhteys luodaan vain kerran, sillä sen luominen on verraten hidasta.</p>
<p>Voit tehdä yhteydelle halutessasi luokan, johon voi sijoittaa muitakin toistuvia tietokantaan liittyviä koodinpätkiä. Jos et halua tehdä luokkaa, voit PHP:llä käyttää myös lyhyttä funktiota, jossa on funktion sisäinen <a href="http://php.net/manual/en/language.variables.scope.php#language.variables.scope.static">staattinen muuttuja</a>:</p>
<p><strong>libs/tietokantayhteys.php</strong></p>
<pre class="sourceCode php"><code class="sourceCode php">&lt;<span class="ot">?</span>php

<span class="co">/** Funktio joka palauttaa yhteyden tietokantaan PDO-oliona. */</span>
<span class="kw">function</span> getTietokantayhteys<span class="ot">()</span> {
  <span class="co">//Muuttuja, jonka sisältö säilyy getTietokantayhteys-kutsujen välillä.</span>
  <span class="kw">static</span> <span class="kw">$yhteys</span> = <span class="kw">null</span><span class="ot">;</span> 
  
  <span class="co">//Jos $yhteys on null, pitää se muodostaa.</span>
  <span class="kw">if</span> <span class="ot">(</span><span class="kw">$yhteys</span> == <span class="kw">null</span><span class="ot">)</span> { 
    <span class="co">//Tämä koodi suoritetaan vain kerran, sillä seuraavilla </span>
    <span class="co">//funktion suorituskerroilla $yhteys-muuttujassa on sisältöä.</span>
    <span class="kw">$yhteys</span> = <span class="kw">new</span> <span class="kw">PDO</span><span class="ot">(</span><span class="st">&#39;pgsql:&#39;</span><span class="ot">);</span>
    <span class="kw">$yhteys</span>-&gt;setAttribute<span class="ot">(</span><span class="kw">PDO</span>::<span class="kw">ATTR_ERRMODE</span><span class="ot">,</span><span class="kw">PDO</span>::<span class="kw">ERRMODE_EXCEPTION</span><span class="ot">);</span>
  }

  <span class="kw">return</span> <span class="kw">$yhteys</span><span class="ot">;</span>
}</code></pre>
<p>Nyt jossain toisessa tiedostossa funktiota voi käyttää vaikkapa näin:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">&lt;?php</span>
  <span class="kw">require</span> <span class="st">&#39;libs/tietokantayhteys.php&#39;</span><span class="ot">;</span>
  <span class="kw">$kysely</span> = getTietokantayhteys<span class="ot">()</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;SELECT 1&quot;</span><span class="ot">);</span>
  <span class="kw">$kysely</span>-&gt;execute<span class="ot">();</span>
  
  <span class="fu">echo</span> <span class="kw">$kysely</span>-&gt;fetchColumn<span class="ot">();</span></code></pre>
<section class="alert alert-success small">
<h3>
Seuraavaksi:
</h3>
<p>Kun olet saanut tietokantaan toimivan yhteyden ja laittanut sen omaan tiedostoonsa, voit jatkaa tietokantaohjelmointia tekemällä <a href="listaustesti.html">yksinkertaisen listauksen</a>.</p>
</section>
</section>
</div>
</div> 
</div> 
<footer>
  <a href="../../sivukartta.html">Sivukartta</a> - 
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>

