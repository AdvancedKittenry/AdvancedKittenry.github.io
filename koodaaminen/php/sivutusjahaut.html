<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Sivutus ja hakulomakkeet</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="../../javascript/jquery.min.js"></script>
  <script src="../../javascript/bootstrap.js"></script>
  <script src="../../javascript/jquery.treeview.js"></script>
  <script src="../../javascript/jquery.scrollTo.js"></script>
  <script src="../../javascript/jquery.nav.js"></script>
  <script src="../../javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/index.html">Viikottaiset palautukset</a>
<ul>
<li><a href="../../aikataulu/viikkopalautukset/esittelysivu.html">Työn esittelysivu</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko1.html">Viikko 1</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko2.html">Viikko 2</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko3.html">Viikko 3</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko4.html">Viikko 4</a></li>
<li><a href="../../aikataulu/viikkopalautukset/viikko5.html">Viikko 5</a></li>
</ul></li>
<li><a href="../../aikataulu/koodikatselmointi.html">Koodikatselmointi</a></li>
<li><a href="../../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../../suunnittelu/index.html">Työn suunnittelu</a>
<ul>
<li><a href="../../suunnittelu/aiheet/index.html">Työaiheet</a>
<ul>
<li><a href="../../suunnittelu/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../../suunnittelu/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../../suunnittelu/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../../suunnittelu/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../../suunnittelu/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../../suunnittelu/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../../suunnittelu/aiheet/Keskustelufoorumi.html">Keskustelufoorumi</a></li>
<li><a href="../../suunnittelu/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../../suunnittelu/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../../suunnittelu/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../../suunnittelu/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../../suunnittelu/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../../suunnittelu/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../../suunnittelu/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../../suunnittelu/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../../suunnittelu/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../../suunnittelu/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../../suunnittelu/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../../suunnittelu/aiheet/Pokemon-kanta.html">Pokémon-tietokanta</a></li>
<li><a href="../../suunnittelu/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../../suunnittelu/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../../suunnittelu/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../../suunnittelu/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../../suunnittelu/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../../suunnittelu/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../../suunnittelu/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../../suunnittelu/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../../suunnittelu/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../../suunnittelu/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../../suunnittelu/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../../suunnittelu/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../../suunnittelu/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../../suunnittelu/tietokannan-valinta.html">Tietokannan valinta</a></li>
<li><a href="../../suunnittelu/kayttoliittyma.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../../suunnittelu/tietokanta.html">Tietokannan suunnittelu</a></li>
</ul></li>
<li><a href="../../pystytys/index.html">Users-palvelin ja töiden pystyttäminen</a>
<ul>
<li><a href="../../pystytys/kayttoonotto/index.html">Palvelujen käynnistäminen ja käyttöönotto</a>
<ul>
<li><a href="../../pystytys/kayttoonotto/java.html">Java ja Tomcatin käyttöönotto</a></li>
<li><a href="../../pystytys/kayttoonotto/mysql.html">MySql-tietokannan käyttöönotto</a></li>
<li><a href="../../pystytys/kayttoonotto/php.html">PHP-tuen käyttöönotto</a></li>
<li><a href="../../pystytys/kayttoonotto/postgresql.html">PostgreSQL-tietokannan käyttöönotto</a></li>
</ul></li>
<li><a href="../../pystytys/netbeans/index.html">NetBeansin käyttöönotto</a>
<ul>
<li><a href="../../pystytys/netbeans/java.html">NetBeansin käyttö Javan kanssa</a></li>
<li><a href="../../pystytys/netbeans/php.html">NetBeansin käyttö PHP:n kanssa</a></li>
<li><a href="../../pystytys/netbeans/keyring-reset.html">Unlock your keyring? - Avainnippujen nollaus</a></li>
</ul></li>
<li><a href="../../pystytys/postgres-ssh-tunneli.html">PostgreSql-kannan etäkäyttö</a></li>
<li><a href="../../pystytys/java-war-paketit.html">Kotikoneella tehdyn Java-työn julkaisu</a></li>
<li><a href="../../pystytys/php-virheet.html">PHP:n virheilmoitusten katselu</a></li>
<li><a href="../../pystytys/nautilus-ssh.html">Tiedostojen etämuokkaus Linuxilla</a></li>
</ul></li>
<li><a href="../../koodaaminen/index.html">Ohjelmointiohjeistus</a>
<ul>
<li><a href="../../koodaaminen/html-opas.html">HTML-opas</a></li>
<li><a href="../../koodaaminen/kannan-alustus.html">Tietokantataulujen pystyttäminen</a></li>
<li><a href="../../koodaaminen/testisovellus.html">ConnectionTest-testisovellus</a></li>
<li><a href="../../koodaaminen/git-ja-salasanat.html">Git-repositoriot ja salasanat</a></li>
<li><a href="../../koodaaminen/arkkitehtuuri/index.html">Arkkitehtuuri ja MVC</a>
<ul>
<li><a href="../../koodaaminen/arkkitehtuuri/nyrkkisaannot.html">MVC-mallin nyrkisääntöjä</a></li>
</ul></li>
<li><a href="../../koodaaminen/java/index.html">Java-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/java/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/java/listaustesti.html">Listaustesti</a></li>
<li><a href="../../koodaaminen/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li><a href="../../koodaaminen/java/nakymat.html">Näkymien tekeminen ja JSP</a></li>
<li><a href="../../koodaaminen/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/java/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/java/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../../koodaaminen/java/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../../koodaaminen/java/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../../koodaaminen/java/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
</ul></li>
<li><a href="../../koodaaminen/php/index.html">PHP-ohjeet</a>
<ul>
<li><a href="../../koodaaminen/php/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../../koodaaminen/php/listaustesti.html">Listaustesti</a></li>
<li><a href="../../koodaaminen/php/rakenne.html">Sovelluksen rakenne ja kontrollerit</a></li>
<li><a href="../../koodaaminen/php/nakymat.html">Näkymien tekeminen</a></li>
<li><a href="../../koodaaminen/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../../koodaaminen/php/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../../koodaaminen/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../../koodaaminen/php/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li class="selected"><a href="../../koodaaminen/php/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../../koodaaminen/php/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../../koodaaminen/php/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
</ul></li>
</ul></li>
<li><a href="../../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../../sivukartta.html">Sivukartta</a></li>
<li><a href="../../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Sivutus ja hakulomakkeet</h1>
</header>
<!-- order: 8.5 -->

<p>Jos tietokannassa on paljon kohteita, kannattaa useimmiten yhdellä sivulla näyttää vain rajattu osajoukko kaikista kohteista. Tähän on käytännössä kaksi tapaa: sivutus ja hakutoiminnon tekeminen. Tavat voi myös yhdistää.</p>
<section id="sivutus" class="level2">
<h2>Sivutus</h2>
<p>Sivutukseen käytetään tietokantatasolla <code>LIMIT</code>-käskyä. Jos halutaan hakea tietokannasta kymmenen kissaa, mallikoodiin laitetaan:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="co">/* Haetaan tietokannasta kasa kissoja */</span>
<span class="kw">$montako</span> = <span class="dv">10</span><span class="ot">;</span>

<span class="kw">$sql</span> = <span class="st">&quot;SELECT * FROM kissat LIMIT ?&quot;</span><span class="ot">;</span>
<span class="kw">$kysely</span> = getTietokantayhteys<span class="ot">()</span>-&gt;prepare<span class="ot">(</span><span class="kw">$sql</span><span class="ot">);</span>
<span class="kw">$kysely</span>-&gt;execute<span class="ot">(</span><span class="fu">array</span><span class="ot">(</span><span class="kw">$montako</span><span class="ot">));</span></code></pre>
<p>Yleensä halutaan määrän rajoittamisen lisäksi myös kertoa mistä kohtaa listaaminen aloitetaan eli monettako sivua haetaan. Tätä varten lista on pakko järjestää, sillä ilman järjestämistä SQL palauttaa tietokantarivit mielivaltaisessa järjestyksessä, mikä tietenkin tekee sivutuksesta täysin hyödyttömän.</p>
<p>Sivun kertomisen ja järjestämisen saa aikaan <code>OFFSET</code>- ja <code>ORDER BY</code>-käskyillä:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">$montako</span> = <span class="dv">10</span><span class="ot">;</span>
<span class="kw">$sivu</span> = <span class="dv">2</span><span class="ot">;</span>

<span class="kw">$sql</span> = <span class="st">&quot;SELECT * FROM kissat LIMIT ? OFFSET ? ORDER by nimi&quot;</span><span class="ot">;</span>
<span class="kw">$kysely</span> = getTietokantayhteys<span class="ot">()</span>-&gt;prepare<span class="ot">(</span><span class="kw">$sql</span><span class="ot">);</span>
<span class="kw">$kysely</span>-&gt;execute<span class="ot">(</span><span class="fu">array</span><span class="ot">(</span><span class="kw">$montako</span><span class="ot">,</span> <span class="ot">(</span><span class="kw">$sivu</span><span class="dv">-1</span><span class="ot">)</span>*<span class="kw">$montako</span><span class="ot">));</span></code></pre>
<p>Malliluokkaan kannattaa koodata myös metodi, joka kertoo listauksessa olevien olioiden kokonaismäärän, näin on mahdollista laskea montako sivua listaan tulee:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> lukumaara<span class="ot">()</span> {
  <span class="kw">$sql</span> = <span class="st">&quot;SELECT count(*) FROM kissat&quot;</span><span class="ot">;</span>
  <span class="kw">$kysely</span> = getTietokantayhteys<span class="ot">()</span>-&gt;prepare<span class="ot">(</span><span class="kw">$sql</span><span class="ot">);</span>
  <span class="kw">$kysely</span>-&gt;execute<span class="ot">();</span>
  <span class="kw">return</span> <span class="kw">$kysely</span>-&gt;fetchColumn<span class="ot">();</span>
}</code></pre>
<section id="sivutus-kontrollerissa-ja-näkymässä" class="level3">
<h3>Sivutus kontrollerissa ja näkymässä</h3>
<p>Kun malliluokkaan on koodattu sopivat metodit, voidaan niitä käyttää kontrollerissa. Se millä sivulla ollaan voidaan ottaa vastaan GET-parametrina ja käyttää sitä määrittämään millä sivulla ollaan:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">&lt;?php</span>
  <span class="kw">$sivu</span> = <span class="dv">1</span><span class="ot">;</span>
  <span class="kw">if</span> <span class="ot">(</span><span class="fu">isset</span><span class="ot">(</span><span class="kw">$_GET</span><span class="ot">[</span><span class="st">&#39;sivu&#39;</span><span class="ot">]))</span> {
    <span class="kw">$sivu</span> = <span class="dt">(int)</span><span class="kw">$_GET</span><span class="ot">[</span><span class="st">&#39;sivu&#39;</span><span class="ot">];</span>

    <span class="co">//Sivunumero ei saa olla pienempi kuin yksi</span>
    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$sivu</span> &lt; <span class="dv">1</span><span class="ot">)</span> <span class="kw">$sivu</span> = <span class="dv">1</span><span class="ot">;</span>
  }
  <span class="kw">$montakokissaasivulla</span> = <span class="dv">10</span><span class="ot">;</span>
  
  <span class="co">//Kysytään mallilta kissoja sivulla $sivu, </span>
  <span class="kw">$kissat</span> = Kissa::getKissatSivulla<span class="ot">(</span><span class="kw">$sivu</span><span class="ot">,</span> <span class="kw">$montakokissaasivulla</span><span class="ot">);</span>

  <span class="co">//Kissojen kokonaislukumäärä haetaan, jotta tiedetään montako sivua kissoja kokonaisuudessa on:</span>
  <span class="kw">$kissaLkm</span> = Kissa::lukumaara<span class="ot">();</span>
  <span class="kw">$sivuja</span> = <span class="fu">ceil</span><span class="ot">(</span><span class="kw">$kissaLkm</span>/<span class="kw">$montakokissaasivulla</span><span class="ot">);</span></code></pre>
<p>Itse sivunavigaatio voi koostua aivan tavallisista linkeistä:</p>
<pre class="sourceCode php"><code class="sourceCode php"><span class="kw">&lt;?php</span> <span class="kw">if</span> <span class="ot">(</span><span class="kw">$data</span>-&gt;sivu &gt; <span class="dv">0</span><span class="ot">)</span>: <span class="kw">?&gt;</span>
&lt;a href=&quot;kissalista.php?sivu=<span class="kw">&lt;?php</span> <span class="fu">echo</span> <span class="kw">$data</span>-&gt;sivu - <span class="dv">1</span><span class="ot">;</span> <span class="kw">?&gt;</span>&quot;&gt;Edellinen sivu&lt;/a&gt;
<span class="kw">&lt;?php</span> <span class="kw">endif</span><span class="ot">;</span> <span class="kw">?&gt;</span>
<span class="kw">&lt;?php</span> <span class="kw">if</span> <span class="ot">(</span><span class="kw">$data</span>-&gt;sivu &lt; <span class="kw">$data</span>-&gt;sivuja<span class="ot">)</span>: <span class="kw">?&gt;</span>
&lt;a href=&quot;kissalista.php?sivu=<span class="kw">&lt;?php</span> <span class="fu">echo</span> <span class="kw">$data</span>-&gt;sivu + <span class="dv">1</span><span class="ot">;</span> <span class="kw">?&gt;</span>&quot;&gt;Seuraava sivu&lt;/a&gt;
<span class="kw">&lt;?php</span> <span class="kw">endif</span><span class="ot">;</span> <span class="kw">?&gt;</span></code></pre>
<p>On myös hyödyllistä kertoa käyttäjälle monennellako sivulla ollaan ja paljonko kissoja on:</p>
<pre class="sourceCode php"><code class="sourceCode php">Yhteensä <span class="kw">&lt;?php</span> <span class="fu">echo</span> <span class="kw">$kissaLkm</span><span class="ot">;</span> <span class="kw">?&gt;</span> kissaa. 
Olet sivulla <span class="kw">&lt;?php</span> <span class="fu">echo</span> <span class="kw">$data</span>-&gt;sivu<span class="ot">;</span> <span class="kw">?&gt;</span>/<span class="kw">&lt;?php</span> <span class="fu">echo</span> <span class="kw">$data</span>-&gt;sivuja<span class="ot">;</span> <span class="kw">?&gt;</span>.</code></pre>
</section>
</section>
<section id="hakulomakkeet" class="level2">
<h2>Hakulomakkeet</h2>
<ul>
<li>Useimmiten on parasta sijoittaa hakulomake samalle sivulle listauksen kanssa.</li>
<li>Haku on kätevä toteuttaa GET-parametrina.</li>
<li>Jos käytetään sekä hakua, että sivutusta, joudutaan sivutuslinkkehiin sisällyttämään hakusana, ettei sivulta toiselle siirtyminen kadottaisi hakua.</li>
<li>Vastaavasti hausta huolehtivan malliluokan metodin pitää tarvittaessa tukea sivutusta.</li>
</ul>
<section class="alert alert-success small"><h3>
Seuraavaksi:
</h3>
<p>Listausnäkymän viimeistelyn jälkeen toteuta <a href="mallit_lisays.html">lisäystoiminto</a>.</p>
</section>




</section>
</div>
</div> 
</div> 
<footer>
  <a href="../../sivukartta.html">Sivukartta</a> - 
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>
