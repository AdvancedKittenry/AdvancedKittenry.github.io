<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Tietokannan suunnittelu</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../css/base.css">
  <link rel="icon" href="../images/kissa.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="../javascript/jquery.min.js"></script>
  <script src="../javascript/bootstrap.js"></script>
  <script src="../javascript/jquery.treeview.js"></script>
  <script src="../javascript/jquery.scrollTo.js"></script>
  <script src="../javascript/jquery.nav.js"></script>
  <script src="../javascript/navi.js"></script>
</head>
<body>
<div class="titlebar">
  <div class="container">
    <div class="row">
      <h1 class="col-md-6 col-md-offset-3">Advanced Kittenry - Tietokantasovellusohjeet</h1>
    </div>
  </div>
</div>
<div class="container">
<div class="row">
<div class="navcontainer col-md-3">
<nav>
<ul>
<li><a href="../index.html">Tietokantasovellus</a>
<ul>
<li><a href="../aikataulu/index.html">Aikataulu</a>
<ul>
<li><a href="../aikataulu/viikkopalautukset/index.html">Viikottaiset palautukset</a>
<ul>
<li><a href="../aikataulu/viikkopalautukset/esittelysivu.html">Työn esittelysivu</a></li>
<li><a href="../aikataulu/viikkopalautukset/viikko1.html">Viikko 1</a></li>
<li><a href="../aikataulu/viikkopalautukset/viikko2.html">Viikko 2</a></li>
<li><a href="../aikataulu/viikkopalautukset/viikko3.html">Viikko 3</a></li>
<li><a href="../aikataulu/viikkopalautukset/viikko4.html">Viikko 4</a></li>
<li><a href="../aikataulu/viikkopalautukset/viikko5.html">Viikko 5</a></li>
</ul></li>
<li><a href="../aikataulu/koodikatselmointi.html">Koodikatselmointi</a></li>
<li><a href="../aikataulu/demo.html">Demotilaisuus</a></li>
<li><a href="../aikataulu/palautus.html">Työn palautus</a></li>
</ul></li>
<li><a href="../suunnittelu_ja_tyoymparisto/index.html">Työn suunnittelu ja työympäristön pystytys</a>
<ul>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/index.html">Työaiheet</a>
<ul>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Drinkkiarkisto.html">Drinkkiarkisto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Elektroninen_keittokirja.html">Elektroninen keittokirja</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Graduaiheet.html">Graduaiheet</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Henkilogalleria.html">Henkilögalleria</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Hiihtokisojen_tulospalvelu.html">Hiihtokisojen tulospalvelu</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Huutokauppa.html">Huutokauppa</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Kennelkerho.html">Kennelkerho</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Keskustelufoorumi.html">Keskustelufoorumi</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Kurssikysely.html">Kurssikysely</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Kurssin_kotisivu.html">Kurssin kotisivu</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Kurssitarjonta_ja_kurssipaikan_varaus.html">Kurssitarjonta ja kurssipaikan varaus</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Laakariaseman_tyovuorolista.html">Lääkäriaseman työvuorolista</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Laakarin_kotikaynnit.html">Lääkärin kotikäynnit</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Matkojen_markkinointi.html">Matkojen markkinointi</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Muistilista.html">Muistilista</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Ostoskassi.html">Ostoskassi</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Palvelubisnes.html">Palvelubisnes</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Parturi-Kampaamo.html">Parturi-Kampaamo</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Pizzapalvelu.html">Pizzapalvelu</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Pokemon-kanta.html">Pokémon-tietokanta</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Projektin_tyoaikaseuranta.html">Projektin työaikaseuranta</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Rankkauslista.html">Rankkauslista</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Taloyhtion_palvelut.html">Taloyhtiön palvelut</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Tavaranvaihto.html">Tavaranvaihto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Tukkuliikkeen_tilaustenksittely.html">Tukkuliikkeen tilaustenkäsittely</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Tutkimusaineston_kerays.html">Tutkimusaineiston keräys</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Tyoaihekanta.html">Työaihekanta</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Opintoneuvonnan_usein_kysytyt_kysymykset.html">Usein kysytyt kysymykset</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Vedonlyonti.html">Vedonlyönti</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Vuokra-asuntojen_valitys.html">Vuokra-asuntojen välitys</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Ystavanvalityspalvelu.html">Ystävänvälityspalvelu</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/aiheet/Aanestys.html">Äänestys</a></li>
</ul></li>
<li><a href="../suunnittelu_ja_tyoymparisto/ohjelmointikielet.html">Ohjelmointikielen valinta</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/tietokannan-valinta.html">Tietokannan valinta</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/git.html">Versionhallinnan käyttöönotto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/alkudokumentointi.html">Perusasioiden dokumentointi</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/users/index.html">Users-palvelin ja töiden pystyttäminen</a>
<ul>
<li><a href="../suunnittelu_ja_tyoymparisto/users/java.html">Java ja Tomcatin käyttöönotto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/users/php.html">PHP-tuen käyttöönotto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/users/mysql.html">MySql-tietokannan käyttöönotto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/users/postgresql.html">PostgreSQL-tietokannan käyttöönotto</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/users/postgres-ssh-tunneli.html">PostgreSql-kannan etäkäyttö</a></li>
</ul></li>
<li><a href="../suunnittelu_ja_tyoymparisto/netbeans/index.html">NetBeansin käyttöönotto</a>
<ul>
<li><a href="../suunnittelu_ja_tyoymparisto/netbeans/java.html">NetBeansin käyttö Javan kanssa</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/netbeans/php.html">NetBeansin käyttö PHP:n kanssa</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/netbeans/keyring-reset.html">Unlock your keyring? - Avainnippujen nollaus</a></li>
</ul></li>
<li><a href="../suunnittelu_ja_tyoymparisto/etamuokkaus.html">Tiedostojen etämuokkaus Linuxilla</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/kayttoliittyma.html">Käyttöliittymän suunnittelu</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/kayttoliittyman_toteutus.html">Käyttöliittymädemon toteuttaminen</a></li>
<li class="selected"><a href="../suunnittelu_ja_tyoymparisto/tietokanta.html">Tietokannan suunnittelu</a></li>
<li><a href="../suunnittelu_ja_tyoymparisto/tietokanta-dokumentointi.html">Tietokannan dokumentointi</a></li>
</ul></li>
<li><a href="../koodaaminen/index.html">Ohjelmointiohjeistus</a>
<ul>
<li><a href="../koodaaminen/kannan-alustus.html">Tietokantataulujen pystyttäminen</a></li>
<li><a href="../koodaaminen/testisovellus.html">ConnectionTest-testisovellus</a></li>
<li><a href="../koodaaminen/git-ja-salasanat.html">Git-repositoriot ja salasanat</a></li>
<li><a href="../koodaaminen/arkkitehtuuri/index.html">Arkkitehtuuri ja MVC</a>
<ul>
<li><a href="../koodaaminen/arkkitehtuuri/nyrkkisaannot.html">MVC-mallin nyrkisääntöjä</a></li>
</ul></li>
<li><a href="../koodaaminen/java/index.html">Java-ohjeet</a>
<ul>
<li><a href="../koodaaminen/java/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../koodaaminen/java/listaustesti.html">Listaustesti</a></li>
<li><a href="../koodaaminen/java/rakenne.html">Sovelluksen rakenne ja servletit</a></li>
<li><a href="../koodaaminen/java/nakymat.html">Näkymien tekeminen ja JSP</a></li>
<li><a href="../koodaaminen/java/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../koodaaminen/java/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../koodaaminen/java/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../koodaaminen/java/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../koodaaminen/java/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../koodaaminen/java/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../koodaaminen/java/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
<li><a href="../koodaaminen/java/java-war-paketit.html">Kotikoneella tehdyn Java-työn julkaisu</a></li>
<li><a href="../koodaaminen/java/tomcatin-korjaaminen.html">Tomcatin ongelmien ratkominen</a></li>
</ul></li>
<li><a href="../koodaaminen/php/index.html">PHP-ohjeet</a>
<ul>
<li><a href="../koodaaminen/php/tietokantayhteys.html">Tietokantayhteyden pystytys</a></li>
<li><a href="../koodaaminen/php/listaustesti.html">Listaustesti</a></li>
<li><a href="../koodaaminen/php/rakenne.html">Sovelluksen rakenne ja kontrollerit</a></li>
<li><a href="../koodaaminen/php/nakymat.html">Näkymien tekeminen</a></li>
<li><a href="../koodaaminen/php/lomakkeet.html">Lomakkeiden käyttö ja vastaanottaminen</a></li>
<li><a href="../koodaaminen/php/mallit_tiedonhaku.html">Tietokantahaku ja kyselyn parametrit</a></li>
<li><a href="../koodaaminen/php/istunnot.html">Istunnot ja kirjautumisen tallentaminen</a></li>
<li><a href="../koodaaminen/php/listausnakymat.html">Listaus- ja tietonäkymät</a></li>
<li><a href="../koodaaminen/php/sivutusjahaut.html">Sivutus ja hakulomakkeet</a></li>
<li><a href="../koodaaminen/php/mallit_lisays.html">Tietojen syöttäminen kantaan</a></li>
<li><a href="../koodaaminen/php/muokkausnakymat.html">Muokkausnäkymän toteuttaminen</a></li>
<li><a href="../koodaaminen/php/syntaksiopas.html">Lyhyt PHP-opas Java-koodarille</a></li>
<li><a href="../koodaaminen/php/php-virheet.html">PHP:n virheilmoitusten katselu</a></li>
</ul></li>
</ul></li>
<li><a href="../arvosteluperusteet.html">Arvosteluperusteet</a></li>
<li><a href="../dokumentaatio-ohje.html">Dokumentaatio-ohje</a></li>
<li><a href="../cleancode.html">Hyvä ohjelmointityyli</a></li>
<li><a href="../kaytettavyys.html">Käytettävyys</a></li>
<li><a href="../sivukartta.html">Sivukartta</a></li>
<li><a href="../web-sovelluksista.html">Web-sovelluksien toiminta</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="col-md-6" id="content">
<header>
<h1 class="title">Tietokannan suunnittelu</h1>
</header>
<!-- order: 12 -->
<!-- tags: viikko2 -->

<section class="alert alert-info"><h3>
Tiivistelmä:
</h3>
<ul>
<li>Suunnittele tietokantasi</li>
<li>Tee tietokantasuunnitelmistasi myös SQL-muotoinen versio, jonka voi ajaa tietokantaan.
<ul>
<li>Tiedostot uuteen <code>sql</code>-nimiseen hakemistoon.</li>
<li>Luo oma tiedosto taulujen luomiselle, testidatan syöttämiselle ja taulujen poistamiselle: <code>create-tables.sql</code>, <code>drop-tables.sql</code> ja <code>add-test-data.sql</code>.</li>
</ul></li>
<li>Jos et ole pitkään aikaan käyttänyt SQL-kieltä, kannattaa lukea alla oleva <a href="#lyhyt-sql-opas">SQL-opas</a>.</li>
</ul>
</section>

<section id="alustava-suunnittelu" class="level2">
<h2>Alustava suunnittelu</h2>
<p>Tee sovelluksellesi alustava käsitekaavio erittelemällä tekemiltäsi sivuilta ja aihekuvauksesta kaikki tietokohteet sekä niiden väliset riippuvuudet yhdellä kaaviolla:</p>
<figure>
<img src="../images/suunnittelu_ja_tyoymparisto/kasitekaavio.jpg" alt="Esimerkki alustavasta käsitekaaviosta" /><figcaption>Esimerkki alustavasta käsitekaaviosta</figcaption>
</figure>
Tässäkin voi olla vielä järkevää käyttää paperia tai valkotaulua, mutta jos suunnitelma on päässäsi jo selkeä, voit käyttää suoraan kaavio-ohjelmistoa, jolloin jälki on siistimpää.
<button type='button' class='btn-link expandable collapsed' data-toggle='collapse' data-target='#expandable_1'>
Siistimpi käsitekaavioversio (avaa tästä)
</button>
  
<div id="expandable_1" class="collapse">
<section>

<figure>
<img src="../images/dokumentaatio-ohje/information_diagram.png" alt="Esimerkki käsitekaaviosta" /><figcaption>Esimerkki käsitekaaviosta</figcaption>
</figure>
</section>
</div>
<p>Kaikki tähän alustavaan käsitekaavioon tulevat asiat eivät välttämättä ole relevantteja ohjelman toteutuksen kannalta. Esimerkiksi palveluskunta ei kokonaisuutena näyttele mitään roolia ohjelman toiminnassa, vaan pääosassa ovat sen jäsenet. Lopullisessa kissalistan toteutuksessa ei tämän takia ole palveluskunta-taulua. Hyvänä valintakriteerinä on se, sisältävätkö tietokohteen instanssit omia kenttiään, edes vaikkapa nimen, vai ovatko ne vain täysin osasistaan koostuvia kokoelma.</p>
</section>
<section id="taulujen-ja-niiden-kenttien-määrittely" class="level2">
<h2>Taulujen ja niiden kenttien määrittely</h2>
<p>Ota nyt jokainen tietokohde, ja määrittele mitä kenttiä siinä pitää olla, jotta kaikki sovelluksen tarvitsemat tiedot saadaan tallennettua.</p>
<p>Kirjoita kentät ja niiden kuvaukset dokumentaatio-ohjeistuksen mukaisesti. Alta voi katsoa esimerkkiä.</p>
<button type='button' class='btn-link expandable collapsed' data-toggle='collapse' data-target='#expandable_2'>
Tietokohdekuvausesimerkki
</button>
  
<div id="expandable_2" class="collapse">
<section>

<div class="panel panel-default">
<div class="panel-body">
<blockquote>
<p><strong>Tietokohde: Huoneisto</strong></p>
<table class="table table-striped table-bordered">
<colgroup>
<col style="width: 17%" />
<col style="width: 23%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Attribuutti</th>
<th style="text-align: left;">Arvojoukko</th>
<th style="text-align: left;">Kuvailu</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Osoite</td>
<td style="text-align: left;">Merkkijono, max. 120 merkkiä</td>
<td style="text-align: left;">Asunnon katuosoite muodossa Paratiisitie 13, Ankkalinna, Calisota, Yhdysvallat</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pinta-ala</td>
<td style="text-align: left;">Desimaaliluku</td>
<td style="text-align: left;">Asunnon pinta-ala neliömetreinä</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hintapyyntö</td>
<td style="text-align: left;">Desimaaliluku</td>
<td style="text-align: left;">Myyjän hintapyyntö euroina.</td>
</tr>
</tbody>
</table>
<p>Huoneisto, joka on annettu myytäväksi, mutta joka ei vielä ole katalogissa voi olla kuulumatta yhdellekään virkailijalle. Kukin huoneisto voi olla kerralla vain yhden virkailijan hoidettavana, mutta virkailijalla voi kuitenkin olla hoidettavanaan useita huoneistoja. Huoneistoon voidaan liittää myös varustelukuvauksia. Yksi varustelukuvaus voi kuvata vain yhtä huoneistoa.</p>
</blockquote>
<p>Katso lisätietoja <a href="../dokumentaatio-ohje.html#järjestelmän-tietosisältö">dokumentaatio-ohjeesta</a>.</p>
</div>
</div>
</section>
</div>
<p>Tässä vaiheessa ei vielä tarvitse miettiä tietokantateknisiä ratkaisuja kuten autogeneroituja id-kenttiä tai viiteavaimia vaan riittää että kirjoitat pelkät kuvaukset taulujen tiedoista ja viittauksista.</p>
</section>
<section id="sql-alustustiedostojen-luonti." class="level2">
<h2>SQL-alustustiedostojen luonti.</h2>
<p>Kun olet suunnitellut kannan rakenteen ja kentät toteuta suunnitelmasi SQL-kielellä.</p>
<p>Luo repositorioosi sql-kansio ja sijoita siihen kolme sql-tiedostoa: <code>create-tables.sql</code>, <code>drop-tables.sql</code> ja <code>add-test-data.sql</code>. Kirjoita näihin tiedostoihin tietokantasi alustavat create table -lauseet, drop table -lauseet, ja testidatan (oletuskäyttäjätunnusten yms.) luominen.</p>
<p>SQL-lauseiden sijoittaminen tiedostoihin mahdollistaa kannan helpon pystyttämisen ja alasajon. Kannattaa testailla tiedostoja ajamalla niitä tietokantaan samalla kun niitä tekee. Näin huomaat heti, jos teet jonkin virheen. Joudut todennäköisesti testaamaan tiedostojasi moneen otteeseen ennen kuin ne toimivat moitteettomasti.</p>
<p>SQL-tiedoston kantaan syöttämiseen on oma ohjeensa <a href="../koodaaminen/kannan-alustus.html">täällä</a>.</p>
</section>
<section id="lyhyt-sql-opas" class="level2">
<h2>Lyhyt SQL-opas</h2>
<p>Jos et ole vähään aikaan ollut SQL-kielen kanssa tekemisissä voit kerrata tästä. Kannattaa lukea etenkin kohdat avainten ja viiteavainten käytöstä, sekä <a href="#monesta-moneen--suhde">monesta moneen -suhteen toteuttamisohje</a>.</p>
<p>Taulujen luomisen syntaksiin voi hakea muistutusta <a href="http://www.w3schools.com/sql/sql_create_table.asp">W3Schoolsin sivuilta</a></p>
<section class="alert alert-warning"><h3>
Vinkki: Käytä hakukonetta
</h3>

<p>Usein on huomattavasti helpompaa etsiä hakukoneella jotain tiettyä tietokannan ominaisuutta hakusanoilla tyyliin <code>autogenerate id mysql</code> tai <code>data types postgres</code> kuin koettaa etsiä niitä käsin tietokannan sivuilta.</p>
</section>

<section id="pääavaimet-ja-viittausavaimet" class="level3">
<h3>Pääavaimet ja viittausavaimet</h3>
<p>Käytännössä jokaisella tietokantasi taululla on erinäinen määrä <em>avaimia</em>. Näistä tärkein on <em>pääavain</em>, joka yksilöi taulunsa rivit, ja johon muut taulut voivat viitata <em>viiteavaimilla</em>.</p>
<p>Pääavaimen on tehokkuussyitä hyvä olla sellainen, jota ei tarvitse myöhemmin muutella usein. Joskus se voi olla jonkin asian nimi, mutta useimmiten on helpompi käyttää yksinkertaista sarjanumerointia. Tietokannat tarjoavatkin tähän valmiita ratkaisuja:</p>
<p><em>Sarjanumerointi</em></p>
<div class="row">
<div class="col-md-6">
<p><em>PostgreSQL</em></p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span></code></pre>
</div>
<div class="col-md-6">
<p><em>MySQL</em></p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">id</span> <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTO_INCREMENT</code></pre>
</div>
</div>
<p>Molempien kantojen tapauksessa tälläiseen pääavaimeen viitataan seuraavasti:</p>
<pre class="sourceCode sql"><code class="sourceCode sql">kissa_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> kissa(<span class="kw">id</span>)</code></pre>
<p>Huomaa, että PostgreSQL:n tapauksessa viittaava tyyppi on aivan erinäköinen kuin siihen viittaava tyyppi. Tämä johtuu siitä, että SERIAL on PostgreSQL:ssä pelkkä lyhennemerkintä lauseelle <code>integer DEFAULT nextval('tablename_colname_seq') NOT NULL</code>, joka samalla luo erillisen sekvenssin, josta tietoja haetaan.</p>
<p>Tälläinen viittaus myös antaa kannan varmistaa, että viitattu rivi on olemassa taulussa. Määritelmän perään on myös mahdollista laittaa lisämääreitä, joilla määritellään mitä tapahtuu, jos viitattu tietue poistuu kannasta tai viitattu arvo muuttuu:</p>
<pre class="sourceCode sql"><code class="sourceCode sql">kissa_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> kissa(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">cascade</span>
                                      <span class="kw">ON</span> <span class="kw">UPDATE</span> <span class="kw">cascade</span></code></pre>
<p>Yllä oleva määritelmä poistaa viittaavan rivin kannasta, jos viitattu rivi poistetaan kannasta. Samoin viittaus päivitetään jos viitattu avain muuttuu. Ellei mitään määritteitä ole laitettu kumpaakaan muutosta ei anneta tehdä, ellei samalla muuteta viittaavaakin taulua.</p>
</section>
<section id="taulujen-väliset-suhteet" class="level3">
<h3>Taulujen väliset suhteet</h3>
<p>Määrittele kaikki projektisi tietokohteiden väliset riippuvuudet ja kunkin kohdalla se, onko kyseessä monesta-moneen-suhde, yhdest-moneen-suhde vai yhdestä-yhteen-suhde. Erityyppiset suhteet toteutetaan tietokantatasolla eri tavalla.</p>
<section id="monesta-yhteen--suhde" class="level4">
<h4>Monesta yhteen -suhde</h4>
<p>Yleisin taulujen välinen suhde on monesta yhteen suhde. Nämä kuvaavat suhteita, joissa jokin asia kuuluu johonkin tai jollekin, esimerkiksi kissa kuuluu rotuun, tai joku omistaa kissan. Näitä suhteita mallinnetaan siten, että omistetut oliot sisältävät viiteavaimen omistajaansa.</p>
<figure>
<img src="../images/suunnittelu_ja_tyoymparisto/one-to-many.png" alt="Monesta yhteen -suhde: Yhdellä kissalla voi olla vain yksi rotu, mutta rotuun voi kuulua monta kissaa." /><figcaption>Monesta yhteen -suhde: Yhdellä kissalla voi olla vain yksi rotu, mutta rotuun voi kuulua monta kissaa.</figcaption>
</figure>
</section>
<section id="monesta-moneen--suhde" class="level4">
<h4>Monesta moneen -suhde</h4>
<p>Toiseksi yleisin suhde on monesta moneen -suhde, jossa molemmat osapuolet voivat olla yhteydessä useaan toiseen olioon. Tämän toteuttamiseksi tarvitaan nk. välitaulua, jossa on viiteavaimet molempiin suhteen tauluihin.</p>
<figure>
<img src="../images/suunnittelu_ja_tyoymparisto/many-to-many.png" alt="Monesta moneen -suhde: Yhdellä kissalla voi olla monta ruokkijaa ja yhdellä palvelijalla monta ruokittavaa." /><figcaption>Monesta moneen -suhde: Yhdellä kissalla voi olla monta ruokkijaa ja yhdellä palvelijalla monta ruokittavaa.</figcaption>
</figure>
<p>Huomaa, että kummassakaan tietokohteessa <em>ei</em> ole suoraa viittausta toiseensa vaan kaikki viittailu tapahtuu välitaulun avulla. Välitaulussa ei myöskään välttämättä ole muuta sisältöä kuin viittausavaimet, jotka toimivat samalla välitaulun pääavainparina.</p>
</section>
<section id="yhdestä-yhteen--suhde" class="level4">
<h4>Yhdestä yhteen -suhde</h4>
<p>Yhdestä yhteen -suhteet ovat hyvin harvinaisia ja niitä näkee lähinnä optimointeina. Ne toteutetaan yleensä siten, että molempien taulujen pääavaimet ovat samat ja viittaavaat toisiinsa.</p>
<figure>
<img src="../images/suunnittelu_ja_tyoymparisto/one-to-one.png" alt="Yhdestä yhteen -suhde: Kissalla on tasan yksi kissakohtainen lisätietotietue" /><figcaption>Yhdestä yhteen -suhde: Kissalla on tasan yksi kissakohtainen lisätietotietue</figcaption>
</figure>
<p>Useimmiten näin ei kuitenkaan kannata tehdä, vaan kannattaa sijoittaa kaikki yhtä asiaa koskevat tiedot yhteen tauluun. Hajauttamisella saavutettu hyöty kun on käytännössä yleensä hyvin pieni.</p>
</section>
</section>
<section id="yleisimmät-tietotyypit" class="level3">
<h3>Yleisimmät tietotyypit</h3>
<table class="table table-striped table-bordered">
<thead>
<tr class="header">
<th style="text-align: left;">Käyttökohde</th>
<th style="text-align: left;">Tietotyyppi</th>
<th style="text-align: left;">Huomioita</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Numeeriset pääavaimet</td>
<td style="text-align: left;">SERIAL, INTEGER AUTO_INCREMENT</td>
<td style="text-align: left;">SERIAL-tyyppiseen avaimeen viitataan aina Unsigned Integer-tyyppisellä kentällä. MYSQL:ssä käytetään samaa tietotyyppiä, mutta lisätään perään määre AUTO_INCREMENT</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kokonaisluvut</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">Käytössä myös SMALLINT, jolla lukualue -32768:sta 32767:aan. Laittamalla eteen UNSIGNED luku pakotetaan positiiviseksi</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Desimaaliluvut</td>
<td style="text-align: left;">DECIMAL(n,k)</td>
<td style="text-align: left;">n määrittää luvun kokonaisosan maksimipituuden ja k desimaalipilkun jälkeen tulevan osan. Euroja voi mitata siis esim. tyypillä Decimal(10,2).</td>
</tr>
<tr class="even">
<td style="text-align: left;">Merkkijonot</td>
<td style="text-align: left;">VARCHAR(n)</td>
<td style="text-align: left;">n määrittää merkkijonon maksimipituuden. MySQL:ää käytettäessä n ei voi ylittää 65535 merkkiä. On myös olemassa fiksatun pituisille merkkijonoille tarkoitettu CHAR(n)-tyyppi, mutta sille on hyvin harvoin oikeaa käyttöä.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kellonajat</td>
<td style="text-align: left;">TIME</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Päivämäärät</td>
<td style="text-align: left;">DATE</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Päivämäärät + kellonaika</td>
<td style="text-align: left;">DATETIME tai TIMESTAMP</td>
<td style="text-align: left;">PostgreSQL tuntee vain TIMESTAMP-tyypin, jonka arvoalue on hyvin laaja. MySQL tukee molempia ja tallentaa ne eri tavalla: MySQL:n TIMESTAMP on lukalueeltaan rajatumpi (70-luvulta n. vuoteen 2038), kun taas DATETIME sisältää ainakin vuodet 1001-9999.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Binääridata (esim. kuvat)</td>
<td style="text-align: left;"><a href="http://www.postgresql.org/docs/8.4/static/datatype-binary.html">BYTEA</a> tai <a href="http://dev.mysql.com/doc/refman/5.1/en/blob.html">BLOB</a></td>
<td style="text-align: left;"><a href="http://www.postgresql.org/docs/8.4/static/datatype-binary.html">BYTEA</a> on PostgreSQL:n binääridatatyyppi, <a href="http://dev.mysql.com/doc/refman/5.1/en/blob.html">BLOB</a> taas MySQL:n binäärityyppi, josta on olemassa useita eri kokoisia versioita.</td>
</tr>
</tbody>
</table>
<p>Lisätietoja löytyy kantojen omilta dokumentaatiosivuilta:</p>
<ul>
<li><a href="http://www.postgresql.org/docs/7.4/static/datatype.html">PostgreSQL:n tietotyypit</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.1/en/data-type-overview.html">MySQL:n tietotyypit</a></li>
</ul>
<section class="alert alert-warning"><h3>
Vinkki
</h3>
<p>Merkkijonokenttien kanssa kannattaa muistaa tehdä kentistä riittävän pitkiä sisältämälleen datalle. Esim. sähköpostit ovat helposti 30 merkkiä pitkiä ja nimetkin voivat yhdysnimien yms. myötä yltää yli kahteenkymmeneen merkkiin.</p>
<p>Salasanankentän voi toteuttaa joko paljaana salasanan sisältävänä tekstikenttänä tai käyttää salasanojen <a href="https://crackstation.net/hashing-security.htm"><em>hashausta</em></a>, jolloin kenttään pitää varata riittävästi tilaa hash- eli <em>tiivistefunktion</em> tuottamalle tiivisteelle.</p>
</section>
</section>
</section>
<section id="linkkejä" class="level2">
<h2>Linkkejä</h2>
<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.1/en/index.html">MySql:n dokumentaatio</a></li>
<li><a href="http://www.postgresql.org/docs/8.4/interactive/index.html">PostgreSql:n dokumentaatio</a></li>
<li><a href="http://www.w3schools.com/sql/default.asp">W3Schoolsin SQL-intro</a></li>
<li>Laineen tietokantojen perusteet -kurssin SQL materiaaleja
<ul>
<li><a href="http://www.cs.helsinki.fi/u/laine/tikape/moniste/osa1.pdf">Osa 1</a></li>
<li><a href="http://www.cs.helsinki.fi/u/laine/tikape/moniste/osa2.pdf">Osa 2</a></li>
<li><a href="http://www.cs.helsinki.fi/u/laine/tikape/moniste/osa3.pdf">Osa 3</a></li>
</ul></li>
</ul>
<section class="alert alert-warning"><h3>
Vinkki
</h3>
<p>Jos SQL-taitosi ovat pahasti ruosteessa, etkä saa kantaa pystyyn on usein helpointa tulla pajaan kysymään SQL-vinkkejä.</p>
</section>

<section class="alert alert-success small"><h3>
Seuraavaksi:
</h3>
<p>Suunniteltuasi tietokannan rakenteen <a href="tietokanta-dokumentointi.html">dokumentoi se</a>.</p>
</section>
</section>
</div>
</div> 
</div> 
<footer>
  <a href="../sivukartta.html">Sivukartta</a> - 
  <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">AdvancedKittenry</span> 
  by
  <a xmlns:cc="http://creativecommons.org/ns#" href="http://advancedkittenry.github.io/credits.html" property="cc:attributionName" rel="cc:attributionURL">David Consuegra and others</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
    <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
  </a>
</footer>
</body>
</html>

